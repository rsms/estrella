#!/usr/bin/env node
var $r=Object.create,Te=Object.defineProperty,Rr=Object.getPrototypeOf,Ar=Object.prototype.hasOwnProperty,Mr=Object.getOwnPropertyNames,Nr=Object.getOwnPropertyDescriptor,dt=e=>Te(e,"__esModule",{value:!0}),ft=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),Wr=(e,t)=>{dt(e);for(var r in t)Te(e,r,{get:t[r],enumerable:!0})},Lr=(e,t,r)=>{if(dt(e),t&&typeof t=="object"||typeof t=="function")for(let n of Mr(t))!Ar.call(e,n)&&n!=="default"&&Te(e,n,{get:()=>t[n],enumerable:!(r=Nr(t,n))||r.enumerable});return e},g=e=>e&&e.__esModule?e:Lr(Te(e!=null?$r(Rr(e)):{},"default",{value:e,enumerable:!0}),e),Tt=ft(pt=>{var mt=Object.defineProperty,Dr=e=>mt(e,"__esModule",{value:!0}),Ur=(e,t)=>{Dr(e);for(var r in t)mt(e,r,{get:t[r],enumerable:!0})};Ur(pt,{PatternError:()=>se,glob:()=>Gr,match:()=>De});var{readdirSync:gt,statSync:Ue}=require("fs"),oe=(()=>{try{return require("path").sep}catch(e){return"/"}})(),U=oe.charCodeAt(0),qr=oe==":"?/\:+/g:oe=="\\"?/\\+/g:/\/+/g,ye=process.platform=="win32",se=class extends Error{constructor(){super("bad pattern")}};function Gr(e){if(e.indexOf("**")<0)return Ge(e);let t=[],r=new Set;return ht("",e.split(/\*{2,}/),0,t,r),t}function H(){}var Yr=ye?e=>{if(e.length<2)return 0;let t=e[0];return e[1]==":"&&("a"<=t&&t<="z"||"A"<=t&&t<="Z")?2:0}:e=>0,Hr=ye?(e,t)=>{let r=t(e);return e==""?[0,"."]:r+1==e.length&&bt(e,e.length-1)?[r+1,e]:r==e.length&&e.length==2?[r,e+"."]:(r>=e.length&&(r=e.length-1),[r,e.substr(0,e.length-1)])}:(e,t)=>e==""?[t,"."]:e==oe?[t,e]:[t,e.substr(0,e.length-1)];function bt(e,t){return e.charCodeAt(t)===U}function Kr(e){let t=e.length-1,r=t;for(;e.charCodeAt(r)===U;)r--;return r!=t?e.substr(0,r+1):e}function zr(e){let t=0,r=t;for(;e.charCodeAt(r)===U;)r++;return r!=t?e.substr(r):e}function ht(e,t,r,n,o){r>=t.length&&(r=t.length-1);let i=t[r],s=i;r===0?i.charCodeAt(i.length-1)!=U&&(s+="*"):r===t.length-1?i.charCodeAt(0)!=U&&(s="*"+s):(i.charCodeAt(0)!=U&&(s="*"+s),i.charCodeAt(i.length-1)!=U&&(s+="*"));function l(d){return o.has(d)?!1:(o.add(d),!0)}function u(d){let S=d,T=S.lastIndexOf(oe);T!=-1&&(S=S.substr(T+1));let j=Math.min(r+1,t.length-1),A=t.slice(j).join("*");A.charCodeAt(0)==U?A=zr(A):A[0]!="*"&&(A="*"+A),De(A,S)&&n.push(d)}e&&(s[0]!=oe?s=e+oe+s:s=e+s);let c=!1;s.charCodeAt(s.length-1)===U&&(c=!0,s=Kr(s));let m=Ge(s);for(let d of m){let S=Ue(d);S.isDirectory()?l(d)&&Jr(d,(T,j)=>{l(T)&&(j.isDirectory()?ht(T,t,r+1,n,o):u(T))}):!c&&l(d)&&u(d)}return n}function Jr(e,t){e=Vr(e);let r=Ue(e);r.isDirectory()&&yt(e,t,new Set([r.ino]))}function yt(e,t,r){for(let n of gt(e)){let o=xt(e,n),i=qe(o),s=t(o,i);(s||s===void 0)&&i&&i.isDirectory()&&!r.has(i.ino)&&(r.add(i.ino),yt(o,t,r))}}function Ge(e){let t=[];if(!St(e))return qe(e)?[e]:t;let r=Yr(e),n=e.length-1;for(;n>=r&&!bt(e,n);)n--;let o=e.substr(0,n+1),i=e.substr(n+1);if([r,o]=Hr(o,r),!St(o.substr(r)))wt(o,i,t);else{if(o==e)throw new se;let s=Ge(o);for(let l of s)wt(l,i,t)}return t}function wt(e,t,r){let n=qe(e);if(n===null)return;if(!n.isDirectory())return;let o;try{o=gt(e)}catch(i){return}o.sort();for(let i of o)De(t,i)&&r.push(xt(e,i))}function St(e){for(let t=0;t<e.length;++t)switch(e.charCodeAt(t)){case 42:case 63:case 91:case 123:return!0}return!1}function Xr(e,t){for(let r=0;r<e.length;++r)if(e.charCodeAt(r)===t)return!0;return!1}function De(e,t){e:for(;e.length>0;){let r=!1,n="",o=e;if([r,n,e]=Zr(e),H("scanChunk(%o) => %o",o,[r,n,e]),r&&n=="")return H("ret"),!Xr(t,U);let[i,s]=Pt(n,t);if(H("matchChunk(%o, %o) => %o",n,t,[i,s]),s&&(i.length==0||e.length>0)){t=i;continue}if(r){for(let l=0;l<t.length&&t.charCodeAt(l)!=U;l++)if([i,s]=Pt(n,t.substr(l+1)),s){if(e.length==0&&i.length>0)continue;t=i;continue e}}return!1}return t.length==0}function Zr(e){let t=!1;for(;e.length>0&&e.charCodeAt(0)==42;)e=e.substr(1),t=!0;let r=!1,n=0>>0;e:for(;n<e.length;n++)switch(e.charCodeAt(n)){case 92:ye||n+1<e.length&&n++;break;case 91:r=!0;break;case 93:r=!1;break;case 42:if(!r)break e;break}return[t,e.substr(0,n),e.substr(n)]}function Pt(e,t){for(H("enter matchChunk(%o, %o)",e,t);e.length>0;){if(t.length==0)return["",!1];switch(e.charCodeAt(0)){case 91:{let o=t.codePointAt(0),i=o<=65535?1:2;if(t=t.substr(i),e=e.substr(1),H('"[" s reduced to %o, chunk reduced to %o, r = 0x%s',t,e,o.toString(16)),e.length==0)throw new se;let s=e.charCodeAt(0)==94;s&&(H('"[" negation from "^"'),e=e.substr(1));let l=!1,u=0;for(;;){if(e.length>0&&e.charCodeAt(0)==93&&u>0){H('"[" loop break at A'),e=e.substr(1);break}let c,m,d=e;if([m,e,c]=Ct(e),H('"[" loop getEsc(%o) => %o',d,[m,e,c]),!c)return H('"[" loop return at B from failed getEsc'),["",!1];let S=m;if(e.charCodeAt(0)==45&&([S,e,c]=Ct(e.substr(1)),!c))return["",!1];m<=o&&o<=S&&(l=!0),u++}if(l==s)return["",!1];break}case 63:if(t.charCodeAt(0)==U)return["",!1];let r=t.codePointAt(0),n=r<=65535?1:2;t=t.substr(n),e=e.substr(1);break;case 92:if(!ye&&(H('"\\" consume'),e=e.substr(1),e.length==0))throw new se;default:if(e.charCodeAt(0)!=t.charCodeAt(0))return H("[def] chunk[0] != s[0] (%o != %o) (0x%s != 0x%s) -- return",e[0],t[0],e.charCodeAt(0).toString(16),t.charCodeAt(0).toString(16)),["",!1];t=t.substr(1),e=e.substr(1),H("[def] s reduced to %o, chunk reduced to %o",t,e);break}}return[t,!0]}function Ct(e){let t=0,r="",n=e.charCodeAt(0);if(e.length==0||n==45||n==93)throw new se;if(n==92&&!ye&&(e=e.substr(1),e.length==0))throw new se;t=e.codePointAt(0);let o=t<=65535?1:2;if(t==65535&&o==1)throw new se;if(r=e.substr(o),r.length==0)throw new se;return[t,r,!0]}function qe(e){try{return Ue(e)}catch(t){}return null}function xt(e,t){return e=="."||e==""?t:e+oe+t}function Vr(e){let t=e.length-1,r=t;for(;r&&e.charCodeAt(r)===U;)--r;return r!=t&&(e=e.substr(0,r+1)),e.split(qr).join(oe)}}),G=ft(exports=>{Wr(exports,{TYPE:()=>TYPE,clock:()=>clock,expandTildePath:()=>expandTildePath,findInPATH:()=>findInPATH,fmtByteSize:()=>fmtByteSize,fmtDuration:()=>fmtDuration,getModulePackageJSON:()=>getModulePackageJSON,isWindows:()=>isWindows,json:()=>json,jsonparse:()=>jsonparse,jsonparseFile:()=>jsonparseFile,repr:()=>repr,resolveModulePackageFile:()=>resolveModulePackageFile,runtimeRequire:()=>runtimeRequire,tildePath:()=>tildePath,tmpdir:()=>tmpdir});var fs=g(require("fs")),Path=g(require("path")),os=g(require("os")),kt=g(require("perf_hooks")),Ft=g(require("util")),json=(e,t,r)=>JSON.stringify(e,r,t),clock=()=>kt.performance.now(),isWindows=process.platform.startsWith("win"),TYPE=Symbol("TYPE"),runtimeRequire=eval("require");function repr(e,t){let r={colors:stdoutStyle.ncolors>0};return typeof t=="object"?r={...t}:t!==void 0&&(r.compact=!t),Ft.inspect(e,r)}function resolveModulePackageFile(e){let t=runtimeRequire.resolve(e),r=Path.dirname(Path.resolve(t)),n=Path.sep;for(;r!=n;){let o=Path.join(r,"package.json");if(fs.existsSync(o))return o;r=Path.dirname(r)}throw new Error(`package.json not found for module ${e}`)}function getModulePackageJSON(e){let t=resolveModulePackageFile(e);return jsonparseFile(t)}var _tmpdir="";function tmpdir(){return _tmpdir||(_tmpdir=fs.realpathSync.native(os.tmpdir())),_tmpdir}function fmtDuration(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function fmtByteSize(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function findInPATH(e){let t=isWindows?4294967295:fs.constants.X_OK,r=new Set((process.env.PATH||"").split(Path.delimiter));for(let n of r){let o=Path.join(Path.resolve(n),e);for(isWindows&&(o+=".cmd");;){try{let i=fs.statSync(o);if(i.isSymbolicLink()){o=fs.realpathSync.native(o);continue}else if(i.isFile()&&i.mode&t)return o}catch(i){if(isWindows&&o.endsWith(".cmd")){o=Path.join(Path.resolve(n),e)+".exe";continue}}break}}return null}function jsonparse(e,t){try{return JSON.parse(json)}catch(r){return require("vm").runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}}function jsonparseFile(e){let t=fs.readFileSync(e,"utf8");try{return jsonparse(t)}catch(r){throw new Error(`failed to parse ${e}: ${r.message||r}`)}}function expandTildePath(e){let t=os.homedir();return e=="~"?t:e.startsWith("~"+Path.sep)?t+e.substr(1):e}function tildePath(e){let t=Path.resolve(e),r=os.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}}),Cr=g(require("esbuild")),J=g(require("fs")),qo=g(require("os")),L=g(require("path")),de=g(Tt());function _t(e,t,r){}_t.throws=!1;global.assert=_t;var vt=g(require("path"));function Et(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function _e(e,t){return It(Et(e,t),t)}function It(e,t){let r=i=>`[${i}m`,n=e>0||t?(i,s)=>{let l=r(i),u=r(s);return c=>l+c+u}:i=>s=>s,o=e>=8?(i,s,l)=>{let u="["+s+"m",c="["+l+"m";return m=>u+m+c}:e>0?(i,s,l)=>{let u="["+i+"m",c="["+l+"m";return m=>u+m+c}:(i,s,l)=>u=>u;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(i,s){let l=Et(i,s);return l!=this.ncolors&&s!=this._hint&&Object.assign(this,It(l,s)),this}}}var stdoutStyle=_e(process.stdout),ie=_e(process.stderr),Bt=g(G()),Ot=g(require("console")),q=g(require("path")),Ee=g(G()),K=(()=>{let e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!q.isAbsolute(e))return e;let r="";if(e){let n=q.basename(process.execPath);e.endsWith(q.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=q.relative(process.cwd(),t);if(!n.startsWith("node_modules"+q.sep)&&n.indexOf(q.sep+"node_modules"+q.sep)==-1)return q.sep=="/"&&(n="./"+n),n}return r+q.basename(t)})();function Ie(e,t){let[r,n]=Qr(t.flags.filter(c=>c)),o={},i=!1,s=[],l=0,u=()=>{s.push(e.splice(l,1)[0]),l--};for(;l<e.length;l++){let c=e[l];if(c=="--"){l++;break}if(c[0]!="-"){u();continue}c=c.replace(/^\-+/,"");let m=c.indexOf("="),d;m!=-1&&(d=c.substr(m+1),c=c.substr(0,m));let S=r.get(c);if(!S){if(c=="h"||c=="help")i=!0,t.help||(console.log(He(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){u();continue}else Ye([e[l]]);break}let T=!0;if(S.valueName){if(d===void 0)if(d=e[l+1],d!==void 0&&d[0]!="-")l++;else{console.error(`missing value for option -${c} (see ${K} -help)`),process.exit(1);break}try{T=S.valueParser?S.valueParser(d):d}catch(j){console.error(`invalid value for option -${c} (${j.message})`)}}else d!==void 0&&(console.error(`unexpected value provided for flag -${c}`),process.exit(1));o[c]=T;for(let j of S.names){if(j==c)continue;o[j]=T}}return l<e.length&&(s=s.concat(e.slice(l))),i&&t.help&&t.help(n,o,s),[o,s]}function Ye(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${K} -help)`),process.exit(1)}function Qr(e){let t=new Map,r=[];for(let n of e){let o=en(n);r.push(o);for(let i of o.names){if(t.has(i))throw new Error(`duplicate CLI flag ${Ee.json(i)} in definition ${Ee.json(n)}`);t.set(i,o)}}return[t,r]}function en(e){let t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,i]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(i)switch(i.toLowerCase()){case"string":case"str":i="string";break;case"bool":case"boolean":i="boolean",n.valueParser=s=>(s=s.toLowerCase(),s!="false"&&s!="0"&&s!="no"&&s!="off");break;case"number":case"num":case"float":case"int":i="number",n.valueParser=s=>{let l=Number(s);if(isNaN(l))throw new Error(`${Ee.json(s)} is not a number`);return l};break;default:throw new Error(`invalid argument type "${i}"`)}else i="string";n.valueName=o||i,n.valueType=i}return n}function He(e,t,r){let n={prog:K,"0":K},o=s=>s.replace(/\$(\w+)/g,(l,u)=>{let c=n[u];if(!c)throw new Error(`unknown variable $${u} (to print a dollar sign, use '\\$')`);return c}),i=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){i+=`
options:
`;let s=0,l=[];for(let u of e){let c="  -"+(u.valueName?u.names.join("=,-")+"="+(u.valueType=="boolean"?"on|off":"<"+u.valueName+">"):u.names.join(", -"));s=Math.max(s,c.length),l.push(c)}for(let u=0;u<e.length;u++){let c=e[u],m=l[u],d=c.description;c.description||(d=c.valueType?"Set ":"Enable "+c.names.reduce((S,T)=>T.length>S.length?T:S,"")),i+=`${m.padEnd(s," ")}  ${d}`,u+1<e.length&&(i+=`
`)}}return r&&(i+=`
`+o(r.replace(/[\n\s]+$/,""))),i}var z;(function(e){e[e.Silent=-1]="Silent",e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(z||(z={}));var fe=console,Ke,le=new class{constructor(){this.SILENT=-1;this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=tn}error(...t){le.level>=0&&(ke(t),fe.error(ie.red(`${K}:`),...t))}warn(...t){le.level>=1&&(ke(t),fe.error(ie.magenta(`${K}:`),...t))}info(...t){le.level>=2&&(ke(t),fe.log(...t))}get colorMode(){return Ke}set colorMode(t){if(Ke===t)return;Ke=t,t===void 0?fe=console:fe=new Ot.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t})}},a=le;function ke(e){typeof e[0]=="function"&&(e[0]=e[0]())}function tn(...e){if(le.level>=3){let t="";if(ke(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;fe.log(stdoutStyle.bold(stdoutStyle.blue(`[DEBUG${t}]`)),...e)}}var rn=__dirname;function jt(e){let t=null;return function(){return t||(le.debug(`loading ${e} module`),t=Bt.runtimeRequire(vt.join(rn,e)),t.initModule(le.level)),t}}var pe=jt("debug.js"),ze=jt("watch.js"),ae=class extends Error{constructor(t){super(t);this.name="UserError"}};function $t(e,t){return pe().bugReportMessage(e,t)}function Rt(e,t){return pe().printErrorAndExit(e,t)}function At(e,t){Error.prepareStackTrace=void 0;try{if(pe().installSourceMapSupport(),Error.prepareStackTrace!==At)return Error.prepareStackTrace(e,t)}catch(r){}return e.stack||String(e)}Error.prepareStackTrace=At;process.on("uncaughtException",Rt);process.on("unhandledRejection",(e,t)=>{Rt(e||"PromiseRejection","unhandledRejection")});var h=g(G()),nn=g(G()),Jn=new Map,Vn=Symbol("isMemoized"),Mt=!!process.stdout.isTTY,on=!!process.stderr.isTTY,te={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((te.width-1)/e.length))}};if(Mt||on){let e=Mt&&process.stdout||process.stderr,t=()=>{te.width=e.columns,te.height=e.rows};e.on("resize",t),t(),te.clear=()=>{e.write("c")}}var Ze=g(require("path")),ro=g(require("fs")),Ut=g(require("child_process")),ge=g(G()),Z=g(require("path")),Nt=g(require("fs")),Fe=g(G()),Wt=Symbol("TS_CONFIG_FILE"),Lt=Symbol("TS_CONFIG"),{dirname:sn,basename:eo}=Z;function Dt(e){let t="",r=process.cwd(),n=Fe.isWindows?"tsc.cmd":"tsc";e&&process.chdir(e);try{t=require.resolve("typescript")}catch(o){}if(e&&process.chdir(r),t){let o=Z.sep+"node_modules"+Z.sep,i=t.indexOf(o);if(i!=-1)return Z.join(t.substr(0,i+o.length-Z.sep.length),".bin",n)}return n}function Ve(e,t){for(let r of Je(e,t))try{let n=Nt.statSync(r);if(n.isFile())return r}catch(n){}return null}function*Je(e,t){e=Z.resolve(e);let r=Z.parse(e).root;for(t=t?Z.resolve(t):r;!(yield Z.join(e,"tsconfig.json"),e==t);)if(e=sn(e),e==r)break}function Xe(e){let t=e.cwd||process.cwd();return e.entryPoints&&e.entryPoints.length>0&&(t=Z.resolve(t,Z.dirname(e.entryPoints[0]))),t}function me(e){let t=e[Wt];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=Xe(e);t=Ve(r,e.cwd)}Object.defineProperty(e,Wt,{value:t})}return t}function xe(e){let t=e[Lt];if(t===void 0){let r=me(e);if(r)try{t=Fe.jsonparseFile(r)}catch(n){a.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,Lt,{value:t})}return t}var{dirname:ln,basename:co}=Ze,Qe={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},Gt=0,qt=1,Yt=2,an=3,Ht={IGNORE:Gt,INFO:qt,WARNING:Yt,ERROR:an};function Kt(e,t){for(let r of Object.keys(t)){let n=Ht[String(t[r]).toUpperCase()];if(n===void 0)throw new ae(`Invalid value for TS rule ${r}: ${ge.json(n)} -- expected value to be one of: `+Object.keys(Ht).map(ge.json).join(", "));e[r]=n}}function et(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);let i=e.cwd||process.cwd(),s=e.tsconfigFile;if(s===void 0&&(s=Ve(e.srcdir?Ze.resolve(i,e.srcdir):i)),e.mode!="on"&&!s)return n(!0);let l=e.format?e.format.toLowerCase():"",u=l.startsWith("short"),c=l.startsWith("short"),m=l=="short-all",d=Dt(e.cwd);if(d=="tsc"&&e.mode!="on"&&!(d=ge.findInPATH(d)))return a.warn("tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+Ze.relative(process.cwd(),ln(s))+'. Set tslint options.tslint="off" or pass -no-diag on the command line to disable tsc.'),n(!0);let S={};Kt(S,Qe),e.rules&&Kt(S,e.rules);let T=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",s&&"--project",s].concat(e.args||[]).filter(w=>w);a.debug(()=>`spawning process ${d} ${ge.json(T,2)}`);let j=Ut.spawn(d,T,{stdio:["inherit","pipe","inherit"],cwd:i}),A=()=>{try{j.kill()}catch(w){}};process.on("exit",A),t.cancel=()=>{j.kill()};let f=w=>w,b=stdoutStyle.orange,P=stdoutStyle.red,F=stdoutStyle.green,k=Buffer.from(" TS"),_=Buffer.from("Found "),I=Buffer.from("c"),v=Buffer.from("tarting compilation"),W=Buffer.from("tarting incremental compilation"),M=[],p=0,y=!1,x={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},C=!1;function E(){if(!e.quiet||x.errors>=0){e.watch&&console.log(te.banner("\u2014"));let w=[];x.errors>0?w.push(P("TS: "+ce("$ error","$ errors",x.errors))):w.push(F("TS: OK")),x.warnings>0&&w.push(b(ce("$ warning","$ warnings",x.warnings))),x.other>0&&w.push(ce("$ message","$ messages",x.other)),console.log(w.join("   ")),e.watch&&console.log(te.banner("\u2014"))}y=x.errors>0,e.onEnd&&e.onEnd(x),x.reset(),C=!0}function X(w){let O=M.slice();if(M.length=0,p==0){let B=0,N=O[B++];for(;N.length==0||N[0]==10&&B<O.length;)N=O[B++];if(N.includes(v)||N.includes(W))return x.reset(),w&&E();if(O.every(ne=>ne.length<=1))return w&&E()}else{let B=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g,N=O.shift().toString("utf8");switch(S[p]){case Gt:return w&&E();case qt:N=N.replace(B,f("info")),u?O=[]:Pe(O,f),x.other++;break;case Yt:N=N.replace(B,b("warning")),c?O=[]:Pe(O,b),x.warnings++;break;default:m&&(O=[]),B.test(N)?x.errors++:x.other++;break}process.stdout.write(N)}O.forEach(B=>process.stdout.write(B)),w&&E()}function Pe(w,O){for(let B=1;B<w.length;B++){let N=w[B];if(N.includes(126)){let ne=N.toString("utf8");ne=ne.replace(/\x1b\[\d+m(\s*~+)/g,O("$1")),w[B]=ne}}}function ce(w,O,B){return(B==1?w:O).replace(/\$/g,B)}un(j.stdout,(w,O)=>{if(e.clearScreen||(w=Le(w)),O){w.length>0&&M.push(w),M.length>0&&X();return}if(C&&w.length>1&&(C=!1,e.onRestart&&e.onRestart()),w.includes(_)){let B=Ce(w.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(B)){X(!0),p=0;return}else X(!1);p=0}else if(w.includes(k)){let B=w.toString("utf8"),N=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(B),ne=N?parseInt(N[1]):0;ne>0&&!isNaN(ne)&&(M.length>0&&X(),p=ne)}M.push(w)}),j.on("close",w=>{process.removeListener("exit",A),n(!y)});function Ce(w){return w.replace(/\x1b\[\d+m/g,"")}function Le(w){let O=w.indexOf(I);return O==-1?w:O==0?w.subarray(3):Buffer.concat([w.subarray(0,O),w.subarray(O+3)],w.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}var cn=Buffer.allocUnsafe(0);function un(e,t){let r=[],n=0,o=s=>{let l=0;for(;;){let u=s.indexOf(10,l);if(u==-1){if(l<s.length-1){let m=s.subarray(l);r.push(m),n+=m.length}break}u++;let c=s.subarray(l,u);n>0&&(c=Buffer.concat(r.concat(c),n+c.length),r.length=0,n=0),t(c,!1),l=u}},i=()=>{r.length>0?t(Buffer.concat(r,n),!0):t(cn,!0)};e.on("data",o),e.on("close",i),e.on("end",i)}var lr=g(require("fs")),st=g(G()),Q=g(require("fs")),tr=g(require("os")),rr=g(require("child_process")),nr=g(require("stream")),dn=g(require("fs")),he=g(G());function zt(e){return e&&e.read}function Jt(e){return e&&e.write}var tt=Buffer.allocUnsafe(0);function Vt(e){return e&&typeof e=="object"&&e[he.TYPE]=="Reader"}function Oe(e){return e?new Xt(e):fn}function rt(e){return e?{[he.TYPE]:"Writer",stream:e}:pn}var mo,fn=new class{constructor(){this[mo]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(mo=he.TYPE,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}},go,Zt,pn=new(Zt=class{constructor(){this[go]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},go=he.TYPE,Zt),ho,Xt=class{constructor(t){this[ho]="Reader";this._ended=!1;this.stream=t,t.pause(),t.once("end",()=>{this._ended=!0})}[(ho=he.TYPE,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(t,r){let n=this.stream;if(n.pause(),typeof t=="string")r=t,t=Number.MAX_SAFE_INTEGER;else if(t==null||t<0)t=Number.MAX_SAFE_INTEGER;else if(t==0)return r?"":tt;if(n.readable){let l=n.read(this._ended?void 0:t);if(l)return r?l.toString(r):l}if(this._ended)return r?"":tt;let o=[],i=0;if(n.readable){let l=n.read();l&&(o.push(l),i+=l.length)}for(;i<t&&!this._ended;){await new Promise((u,c)=>{n.once("error",c),n.once("end",u),n.once("readable",u)});let l=n.read(t-i);l||(l=n.read()),l&&(o.push(l),i+=l.length)}let s=Qt(o);return r?s.toString(r):s}};function Qt(e,t){return e.length==0?tt:e.length==1?e[0]:Buffer.concat(e,t)}function nt(){let e=[],t=0,r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>Qt(e,t),e}function ot(e){let t=pe().libuv_errors;return t[e]||""}function er(e,t,r){let n=setTimeout(()=>{let o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}var ue=g(G()),or="process not started",ve=class{constructor(t,...r){this.dir="";this.env={...process.env};this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=t=>{a.debug(()=>`${this} error:
${t.stack||t}`),this._reject(t)};this._onexit=(t,r)=>{let n=this;a.debug(()=>`${n} exited status=${t} signal=${r}`),n.running=!1,t===null||r!==null?(assert(typeof r=="string"),n.exitCode=-(tr.constants.signals[r]||1)):n.exitCode=t||0,n._resolve(n.exitCode)};this.command=t,this.args=r,this.promise=Promise.reject(new Error(or)),this.promise.catch(n=>{})}start(){return null}run(t){return this.start(),this.wait(t)}output(t,r){this.stdout="pipe",this.stderr||(this.stderr="pipe");let{stdout:n,stderr:o}=this.start(),i=nt(),s=nt();return n.stream.on("data",l=>{i.push(l)}),o&&o.stream.on("data",l=>{s.push(l)}),this.wait(r||0).then(l=>{if(l!=0){let c="",m=s.buffer();try{c=m.toString("utf8")}catch(d){c=m.toString("ascii")}throw c.length>0&&(c=`. stderr output:
`+c),new Error(`command exited with status ${l}${c}`)}let u=i.buffer();return t?u.toString(t):u})}wait(t,r){return t===void 0||t<=0?this.promise:this._waitTimeout(t,(n,o,i)=>(a.debug(()=>`${this} wait timeout reached; killing process`),n.message="Cmd.wait timeout",this.kill(r).then(()=>i(n))))}signal(t,r){let n=this._checkproc();if(r=="group")try{return process.kill(-n.pid,t),!0}catch(o){}return n.kill(t)}async kill(t="SIGTERM",r=500,n){let o=this._checkproc();return this.signal(t,n||"group")?r<=0?this.promise:this._waitTimeout(r,(i,s)=>(a.debug(()=>`${this} kill timeout reached; sending SIGKILL`),o.kill("SIGKILL"),this.promise.then(s))):o.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(or);return this.process}_rejectAndKill(t){this._reject(t)}_waitTimeout(t,r){return new Promise((n,o)=>{let i=!1;return this.promise.then(s=>{i||n(s)}),er(this.promise,t,s=>{i=!0,r(s,n,o)})})}};ve.prototype.start=function(){let t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((l,u)=>{t._resolve=l,t._reject=u});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":Vt(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;let o={stdio:[r||"ignore",t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?ue.expandTildePath(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!ue.isWindows},i=rr.spawn(t.command,t.args,o);if(i.pid===void 0){t.process=null,t.pid=0;let l=mn(t);throw t._reject(l),l}if(t.running=!0,t.process=i,t.pid=i.pid,i.on("exit",t._onexit),i.on("error",t._reject),a.debug(()=>`${t} started (${ue.repr(t.command)})`),i.stdin)if(t.stdin instanceof Buffer){let l=new nr.PassThrough;l.end(t.stdin),l.pipe(i.stdin),i.stdin=null}else n&&(n.pipe(i.stdin),i.stdin=null);if(!i.stdin&&!i.stdout&&!i.stderr&&i.stdio.length<4)return null;let s={stdin:i.stdin?rt(i.stdin):null,stdout:i.stdout?Oe(i.stdout):null,stderr:i.stderr?Oe(i.stderr):null,extraFiles:i.stdio.slice(3).map(l=>zt(l)?Oe(l):Jt(l)?rt(l):null)};return s};function mn(e){let t="",r="unspecified error";if(e.shell==!1){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK);let o=Q.statSync(e.command);(o.mode&Q.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r}if(!t){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r,t&&(r=r+"; cmd.dir="+ue.repr(e.dir))}t||(t="UNKNOWN");let n=new Error(`failed to spawn process ${ue.repr(e.command)} (${t} ${r})`);return n.code=t,n}var it=g(require("fs")),ir=g(require("os")),sr=new Map;function we(e,t){let r=o=>it.writeSync(process.stderr.fd,o+`
`),n=sr.get(e);if(n)n.listeners.add(t);else{let o=new Set([t]),i=s=>{s=="SIGINT"&&it.writeSync(1,`
`);try{for(let l of o)l(s)}catch(l){r(`error in signal listener: ${l.stack||l}`)}process.exit(-(ir.constants.signals[s]||1))};process.on(e,i),sr.set(e,{rootListener:i,listeners:o})}}var ar=!1,ur=!1,Be=new Set;function gn(){if(ar)return;ar=!0,process.on("beforeExit",t=>lt(!1)),process.on("exit",t=>lt(!1));let e=t=>lt(!1);we("SIGINT",e),we("SIGHUP",e),we("SIGTERM",e),we("SIGPIPE",e)}function lt(e){if(ur)return;ur=!0;let t=r=>lr.writeSync(process.stderr.fd,r+`
`);try{for(let r of Be)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch(n){}Be.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function dr(e){if(!e.run)return;a.debug(()=>`run.configure run=${st.repr(e.run)}`);let t=new cr(e);Be.add(t);let r=e.onEnd;e.onEnd=async(n,o,i)=>{if(await t.onEndBuild(o),typeof r=="function")return r(n,o,i)},gn()}function fr(){return Promise.all(Array.from(Be).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}var cr=class{constructor(t){this._logOnExit=!0;if(this.config=t,this.cmd=new ve(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.3.0",typeof t.run=="string")this.cmd.command=t.run,this.cmd.shell=!0,this.cmdname=t.run;else if(typeof t.run=="boolean"){if(!t.outfile)throw new ae("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[t.outfileAbs],this.cmdname=t.outfile}else{if(!t.run||t.run.length==0)throw new ae("config.run is an empty list");this.cmd.command=t.run[0],this.cmd.args=t.run.slice(1),this.cmdname=t.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(t){if(t.errors.length>0)return;let r=this.cmd,n=stdoutStyle.pink,o=r.running;r.running&&(this._logOnExit=!1,a.debug(()=>`Stopping ${this.cmdname} [${r.pid}] ...`),await r.kill()),a.debug(()=>`Starting command ${st.repr([r.command,...r.args])}`),r.start(),this.config.watch&&(a.info(()=>n(`${o?"Restarted":"Running"} ${this.cmdname} [${r.pid}]`)),this._logOnExit=!0,r.promise.then(i=>{this._logOnExit&&a.info(()=>n(`${this.cmdname} exited (${i})`))}))}},je=g(G());function pr(e){let t=e;if(!t){a.debug("typescript API requested; attempting to load typescript module");try{let f=require;if(t=f("typescript"),parseFloat(t.versionMajorMinor)<3.5)return a.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;a.debug(()=>`loaded typescript ${t.version} from ${je.tildePath(f.resolve("typescript"))}`)}catch(f){return a.debug(()=>"failed to load typescript; module unavailable"),null}}let r=new Map;function n(f){let b=je.json(Object.keys(f).sort().map(_=>[_,f[_]])),P=r.get(b);if(P)return a.debug("ts.getCompilerHost cache hit"),P;f={newLine:t.NewLineKind.LineFeed,...f};let F=t.createCompilerHost(f,!0),k=[F,f];return r.set(b,k),a.debug("ts.getCompilerHost cache miss"),k}async function o(f,b){let P=typeof f=="string"?{"/<source>/a.ts":f}:f,F=Object.keys(P),[k,_]=n(b||{}),I=k.readFile;k.readFile=M=>M in P?P[M]:I(M);let v=t.createProgram(F,_,k);if(typeof f=="string")return v.getSourceFile(F[0]);let W={};for(let M of F)W[M]=v.getSourceFile(M);return W}async function i(f,b){return s(f,b)}function s(f,b){let[P,F]=n(b||{}),k=t.createProgram([f],F,P),_=k.getSourceFile(f);if(!_)throw new Error(`${f}: file not found`);return _}function l(f,b,P){return u(f,[b],P).then(F=>F[0])}async function u(f,b,P){let F=s(f,P);return c(F,b)}function c(f,b){let P=T(f),F=new Map,k=[];for(let _ of b||P.keys()){let I=P.get(_);if(!I){k.push(null);continue}k.push(m(f,I,P,F))}return k}function m(f,b,P,F){let k=F.get(b);if(k)return k;let _={heritage:[],name:b.name.escapedText,props:{},computedProps(){let I={};for(let v of _.heritage)Object.assign(I,v.props);return Object.assign(I,_.props),I},lookupProp(I){let v=_.props[I];if(!v){for(let W of _.heritage)if(v=W.lookupProp(I))break}return v}};if(F.set(b,_),b.heritageClauses)for(let I of b.heritageClauses)for(let v of I.types){let W=v.expression;if(t.isIdentifier(W)){let M=P.get(W.escapedText);M&&_.heritage.push(m(f,M,P,F))}}return b.forEachChild(I=>{if(t.isPropertySignature(I)){let v=d(I,f,_);_.props[v.name]=v}}),_}function d(f,b,P){let F=t.getLineAndCharacterOfPosition(b,f.pos),k=null,_=f.type,I=S(f.name),v={name:I,type:_,get typestr(){return k===null&&(k=_?A(_,b):"any"),Object.defineProperty(v,"typestr",{enumerable:!0,value:k}),k},srcfile:b.fileName,srcline:F.line,srccol:F.character,parent:P};return v}function S(f){switch(f.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return f.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return f.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function T(f){let b=new Map;return t.forEachChild(f,P=>{P.kind==t.SyntaxKind.InterfaceDeclaration&&b.set(P.name.escapedText,P)}),b}let j=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function A(f,b){if(!b){let P=f;for(;P.kind!=t.SyntaxKind.SourceFile;)if(P=P.parent,!P)throw new Error("node without SourceFile parent (provide file to ts.fmt)");b=P}return j.printNode(t.EmitHint.Unspecified,f,b)}return{ts:t,getCompilerHost:n,parse:o,parseFile:i,interfaceInfo:l,interfacesInfo:u,interfacesInfoAST:c,fmt:A}}var D=g(require("fs")),Y=g(require("path")),br=g(require("crypto")),re=g(require("fs")),$e=g(G()),mr=String.fromCharCode,hn=(e,t)=>e.charCodeAt(t||0);function gr(e,t){if(typeof t=="number")return re.chmodSync(e,t),t;let r=re.statSync(e).mode,n=Re(r,t);return r!=n&&re.chmodSync(e,n),n}function hr(e,t){return new Promise((r,n)=>{if(typeof t=="number")return re.chmod(e,t,o=>{o?n(o):r(t)});re.stat(e,(o,i)=>{if(o)return n(o);let s=Re(i.mode,t);if(i.mode==s)return r(s);re.chmod(e,s,l=>{l?n(l):r(s)})})})}function Re(e,t){let r="Expected format: [ugoa]*[+-=][rwx]+",n=(i,s)=>new Error(`${i} in modifier ${$e.json(s)}. ${r}`),o=[];for(let i of Array.isArray(t)?t:[t])o=o.concat(i.trim().split(/\s*,+\s*/));for(let i of o){let s=[],l=!1,u=0,c=0;for(let d=0;d<i.length;d++){let S=hn(i,d);if(u==0)switch(S){case 117:case 103:case 111:l||s.push(S);break;case 97:s=[117,103,111],l=!0;break;case 43:case 45:case 61:u=S;break;default:if(u==0)throw n(`Invalid target or operation ${$e.json(mr(S))}`,i);break}else switch(S){case 114:c|=4;break;case 119:c|=2;break;case 120:c|=1;break;default:throw n(`Invalid permission ${$e.json(mr(S))}`,i)}}if(u==0)throw n("Missing operation",i);s.length==0&&(s=[117]),c==0&&(c=4|2|1);let m=0;for(let d of s)switch(d){case 117:m|=c<<6;break;case 103:m|=c<<3;break;case 111:m|=c;break}switch(u){case 43:e|=m;break;case 45:e&=~m;break;case 61:e=m;break}}return e}var Ae=g(G()),ee=D.promises,bn={};function Me(e){bn[Y.resolve(String(e))]=Ae.clock()}function R(e,t){return ee.readFile(e,t)}R.editMode=Re;R.chmod=(e,t)=>(Me(e),hr(e,t));function yn(e,t){return ee.readFile(e,t)}R.read=yn;function xn(e,t){return D.readFileSync(e,t)}R.readSync=xn;R.stat=ee.stat;function wn(...e){return Promise.all(e.map(t=>ee.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}R.mtime=wn;R.readall=(...e)=>Promise.all(e.map(t=>ee.readFile(t)));R.readallText=(e,...t)=>Promise.all(t.map(r=>ee.readFile(r,{encoding:e||"utf8"})));R.write=async(e,t,r)=>{Me(e);let n=r&&typeof r=="object"?r:{};try{await ee.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await R.mkdirs(Y.dirname(String(e)),n.mkdirMode),await ee.writeFile(e,t,r);else throw o}if(n.log){let o=Y.relative(process.cwd(),String(e));o.startsWith(".."+Y.sep)&&(o=Ae.tildePath(e)),a.info(stdoutStyle.green(`Wrote ${o}`))}};R.writeSync=(e,t,r)=>{D.writeFileSync(e,t,r)};function Sn(e,t){return new Promise((r,n)=>{let o=D.createReadStream(e),i=br.createHash("sha1");o.on("error",n),o.on("end",()=>{i.end(),r(t?i.digest(t):i.digest())}),o.pipe(i)})}R.sha1=Sn;R.copy=(e,t,r)=>{let n=D.constants.COPYFILE_FICLONE;return r&&(n|=D.constants.COPYFILE_EXCL),Me(t),ee.copyFile(e,t,n)};R.move=(e,t)=>(Me(t),ee.rename(e,t));R.mkdirs=(e,t)=>ee.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function yr(e,t,r){if(r||(r={}),!D.promises||!D.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");let n=[],o=new Set,i=r.recursive!==void 0?r.recursive?Infinity:0:r.depth!==void 0?r.depth:Infinity;async function s(u,c,m){if(o.has(u))return;o.add(u);let d=await D.promises.opendir(u);for await(let S of d){let T=S.name;S.isDirectory()?i<m&&await s(Y.join(u,T),Y.join(c,T),m+1):(S.isFile()||S.isSymbolicLink())&&(t&&t.test(T)&&n.push(Y.join(c,T)))}}let l=Array.isArray(e)?e:[e];return Promise.all(l.map(u=>s(Y.resolve(u),".",0))).then(()=>n.sort())}var xr={version:"0.8.24",BuildOptions:new Set(["sourcemap","format","globalName","target","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","charset","treeShaking","jsxFactory","jsxFragment","define","pure","avoidTDZ","keepNames","banner","footer","color","logLevel","errorLimit","bundle","splitting","outfile","metafile","outdir","outbase","platform","external","loader","resolveExtensions","mainFields","write","tsconfig","outExtension","publicPath","inject","incremental","entryPoints","stdin","plugins"])},wr={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","silent","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])},Se=g(require("path")),Sr=g(require("crypto"));function Ne(e,t){let r=Sr.createHash("sha1").update(e);return t?r.digest(t):r.digest()}function Pr(e,t){let r=e.cwd||"?",n=!1,o=!1,i=!1,s=!1,l="";function u(d){let S=[d.cwd,d.outfile||"",...Array.isArray(d.entryPoints)?d.entryPoints:d.entryPoints?[d.entryPoints]:[]].join(Se.delimiter);return Pn(Ne(Buffer.from(S,"utf8")))}let c=e.cwd?Se.resolve(e.cwd):t,m=Object.create({get outfileAbs(){return l},setOutfile(d){m.outfile=d,l=d&&d!="-"?Se.resolve(m.cwd,d):""},get projectID(){return r},updateProjectID(){return r=u(m),r},get buildIsCancelled(){return n},set buildIsCancelled(d){n=d},get outfileIsTemporary(){return o},set outfileIsTemporary(d){o=d},get outfileCopyToStdout(){return i},set outfileCopyToStdout(d){i=d},get metafileIsTemporary(){return s},set metafileIsTemporary(d){s=d}});return Object.assign(m,e),m.cwd=c,m.setOutfile(e.outfile||""),m}function Pn(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}var{dirname:at,basename:Tr}=L,be={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-silent","Don't log anything, not even errors."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},Cn={usage:"usage: $0 [options] <srcfile> ...",flags:be.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `},ut=Promise.resolve(),$={},V=[],We=Symbol("IS_MAIN_CALL"),_r=!1;function Er(e){if(!_r){_r=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function Tn(e){if(a.debug(()=>`input config ${h.repr(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry&&(Array.isArray(e.entry)?e.entryPoints=e.entryPoints.concat(e.entry):e.entryPoints.push(e.entry)),delete e.entry,e.entryPoints.length==0&&(a.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=Ir(e),e.entryPoints.length==0)){let t=xe(e)?" (could not guess from tsconfig.json)":"";throw new ae(`config.entryPoints is empty or not set${t}`)}if(e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,!e.outfile&&!e.outdir){e.setOutfile("-");let t=e.updateProjectID();e.setOutfile(L.join(h.tmpdir(),`esbuild.${t}.out.js`)),e.outfileIsTemporary=!0}e.updateProjectID(),a.debug(()=>`effective config for project#${e.projectID}: ${h.repr(e)}`)}function _n(e,t){let r=h.clock(),n=JSON.parse(J.readFileSync(e));for(let o in t){let i=t[o];i===void 0?delete n[o]:(typeof i=="function"&&(i=i(n[o])),n[o]=i)}J.writeFileSync(e,JSON.stringify(n)),a.debug(()=>`patched source map ${e} with overrides ${h.repr(t)} (${h.fmtDuration(h.clock()-r)})`)}function Ir(e){let t=xe(e);if(t){if(a.debug(()=>`tsconfig file found at ${me(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)a.debug(`guessing entry points: glob.glob(${n}) =>`,de.glob(n)),r=r.concat(de.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!de.match(n,o));return r.slice(0,1)}}return[]}function En(e){let t={},r={},n={name:"globalName"};for(let o of Object.keys(e)){if(wr.BuildConfig.has(o))continue;xr.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]}return Object.keys(r).length>0&&a.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${h.repr(r)}
`+$t("guess",h.json(Object.keys(r)))),t.outfile||delete t.outfile,t}var kr=new Set;function In(...e){if(a.level>=a.INFO){let t=e.join(" ");kr.has(t)||(kr.add(t),a.info(...e))}}function Fr(e){e=Pr(e||{},e[We]?process.cwd():process.mainModule&&at(process.mainModule.filename)||__dirname);let t={resolve(){},reject(){}},r=[];function n(l){e.isCancelled?l():r.push(l)}function o(l){if(!e.isCancelled){a.debug("build cancelled",{reason:l}),e.isCancelled=!0;for(let u of r)u&&u();r.length=0,l?t.reject(l):t.resolve()}}let i={addCancelCallback:n,buildCounter:0,rebuild(){return a.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}},s=ut.then(()=>new Promise((l,u)=>{if(e.isCancelled)return a.debug("build cancelled immediately"),!1;t.resolve=l,t.reject=u,kn(e,i).then(l).catch(u)}));return s.rebuild=()=>i.rebuild(),Object.defineProperty(s,"buildCounter",{get(){return i.buildCounter}}),s.cancel=o,s}async function kn(e,t){let r=We in e;delete e[We];let n=$,o=V;if(e.run===void 0&&(e.run=n.run),e.outfile=="-"||n.outfile=="-"||r&&!n.outfile&&!n.outdir){e.setOutfile("-");let p=e.updateProjectID();n.outfile=L.join(h.tmpdir(),`esbuild.${p}.out.js`),e.setOutfile(n.outfile),e.outfileIsTemporary=!0,e.outfileCopyToStdout=!0}if(!r)Tn(e);else{if(o.length==0){let p=Ir(e);a.debug(()=>`no input files provided; best guess: ${h.repr(p)}`),p.length==0&&(a.error(`missing <srcfile> argument (see ${K} -help)`),process.exit(1)),o.splice(o.length-1,0,...p);let y=xe(e);!n.outfile&&!n.outdir&&y&&(n.outfile=y.outFile,n.outfile||(n.outdir=y.outDir)),o.length==0&&(a.error(`missing <srcfile> argument (see ${K} -help)`),process.exit(1))}if(e.setOutfile(n.outfile||void 0),e.entryPoints=o,e.outdir=n.outdir||void 0,e.bundle=n.bundle||void 0,e.minify=n.minify||void 0,n.esbuild){let p=h.jsonparse(n.esbuild,"-esbuild");if(!p||typeof p!="object")return a.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof p}.`),!1;a.debug(()=>`applying custom esbuild config ${h.repr(p)}`);for(let y in p)e[y]=p[y]}}let i=e.debug=n.debug=!!(n.debug||e.debug),s=e.silent=n.silent=!!(n.silent||e.silent),l=e.quiet=n.quiet=s||!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(a.colorMode=e.color,stdoutStyle.reconfigure(process.stdout,e.color),ie.reconfigure(process.stderr,e.color)),l&&(a.level=s?a.SILENT:a.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.outfileIsTemporary&&e.outfileCopyToStdout&&e.sourcemap===!0&&(e.sourcemap="inline"),e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,a.debug(()=>`project directory ${h.repr(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||h.tildePath(e.cwd));let u=n.diag===!0?"on":n.diag===!1?"off":"auto";if(u!=="off"){e.tsc!==void 0&&(a.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(u=e.tslint);let p=u==="auto"||typeof u=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode);p?me(e)||(a.debug(()=>{let y=Xe(e),x=Array.from(Je(y,e.cwd));return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${x.map(C=>`
  ${h.tildePath(C)}`)}`}),u="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(u=e.tslint)}e.run&&dr(e);let c=0;function m(){te.clear(),c=h.clock()}let d=!1,S=e.onEnd,T=S?async(p,y)=>{d=!0;let x;try{let E=S(e,p,t);x=E instanceof Promise?await E:E}catch(E){throw a.debug(()=>`error in onEnd handler: ${E.stack||E}`),E}finally{d=!1}let C=x===void 0?y:!!x;return C}:(p,y)=>y;function j(p){let y=T;T=async(x,C)=>{let E=await p(x,C);return E!==void 0&&(C=E),y(x,C)}}e.outfileMode&&e.outfile&&j(async(p,y)=>{if(a.debug("onEnd chmod"),p.errors.length==0)try{gr(e.outfileAbs,e.outfileMode)}catch(x){a.error("configuration error: outfileMode: "+x.message),Er(1)}}),e.outfileCopyToStdout&&!e.run&&e.write!==!1&&j(async(p,y)=>{if(a.debug("onEnd copyToStdout"),p.errors.length==0)return new Promise((x,C)=>{let E=J.createReadStream(e.outfileAbs);E.on("end",()=>x(y)),E.on("error",C),E.pipe(process.stdout)})}),e.outfileIsTemporary&&!e.outfileCopyToStdout&&e.write!==!1&&j(async(p,y)=>{if(a.debug("onEnd load results"),p.js=J.readFileSync(e.outfile,{encoding:"utf8"}),e.sourcemap===!0){try{p.map=J.readFileSync(e.outfile+".map",{encoding:"utf8"})}catch(C){a.debug(`failed to load temporary source map at ${e.outfile}.map: ${C.stack||C}`)}let x=p.js.lastIndexOf(`
//# sourceMappingURL`);x!=-1&&(p.js=p.js.substr(0,x+1))}}),e.watch&&j(async(p,y)=>{In("Watching files for changes...")});let A={DEBUG:i,...e.define||{}};for(let p in A)A[p]=h.json(A[p]);let f={minify:!i,sourcemap:e.sourcemap,color:ie.ncolors>0,logLevel:e.silent?"silent":e.quiet?"warning":"info",...En(e),define:A};if(e.watch){let p=e.projectID;if(!f.outfile&&!f.outdir||f.write===!1)f.outfile=L.join(h.tmpdir(),`esbuild.${p}.out.js`),f.metafile=L.join(h.tmpdir(),`esbuild.${p}.meta.json`),e.outfileIsTemporary=!0,e.metafileIsTemporary=!0,delete f.write;else if(!f.metafile){let y=f.outdir||L.dirname(f.outfile);f.metafile=L.resolve(e.cwd,y,`.esbuild.${p}.meta.json`),e.metafileIsTemporary=!0}}f.metafile&&a.debug(()=>`writing esbuild meta to ${f.metafile}`),t.rebuild=()=>k([]).then(p=>(d&&a.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),p));let b={warnings:[],errors:[]};function P(p,{warnings:y}){Or(y||[]);let x=h.fmtDuration(h.clock()-p);if(!e.outfile)a.info(stdoutStyle.green(e.outdir?`Wrote to dir ${e.outdir} (${x})`:`Finished (write=false, ${x})`));else{let C=e.outfile;if(e.sourcemap&&e.sourcemap!="inline"&&e.write!==!1){let X=L.extname(e.outfile),Pe=L.join(L.dirname(e.outfile),L.basename(e.outfile,X));C=`${Pe}.{${X.substr(1)},${X.substr(1)}.map}`;let ce={sourcesContent:void 0,sourceRoot:L.relative(L.dirname(e.outfile),e.cwd)};e.outfileIsTemporary&&(ce.sourceRoot=".",ce.sources=Ce=>Ce&&Ce.map(Le=>L.relative(process.cwd(),Le))),_n(e.outfileAbs+".map",ce)}let E=0;try{E=J.statSync(e.outfileAbs).size}catch(X){}e.outfileIsTemporary||a.info(stdoutStyle.green(`Wrote ${C}`)+` (${h.fmtByteSize(E)}, ${x})`)}return b={warnings:y,errors:[]},T(b,!0)}function F(p,y,x){let C=y.warnings||[],E=y.errors||[],X=x&&x.showStackTrace;return E.length==0&&(a.error(y.message),E.push({text:String(X&&y.stack?y.stack:y),location:null})),Or(C),b={warnings:C,errors:E},T(b,!1)}async function k(p){if(e.watch&&e.clear&&m(),e.onStart)try{let C=e.onStart(e,p,t);C instanceof Promise&&await C}catch(C){throw a.debug(()=>`error in onStart handler: ${C.stack||C}`),C}if(e.isCancelled)return;a.debug(()=>`invoking esbuild.build() in ${process.cwd()} with options: ${h.repr(f)}`);let y=process.cwd();process.chdir(e.cwd);let x=Cr.build(f);return process.chdir(y),x.then(P.bind(null,h.clock()),F.bind(null,h.clock()))}let _=n.diag?null:k([]),[I,v]=u!=="off"?Fn(u,n,e):[null,!1];I&&!v&&(I.catch(p=>(a.error(p.stack||String(p)),!1)),t.addCancelCallback(()=>{I.cancel()}),$.diag&&e.watch&&e.clear&&te.clear());let W=!0;if(_&&(a.debug("awaiting esbuild"),W=await _,e.isCancelled))return!1;if(e.watch){let p={};function M(){try{p=h.jsonparseFile(f.metafile),e.metafileIsTemporary&&(a.debug(()=>`removing temporary esbuild metafile ${f.metafile}`),J.unlink(f.metafile,()=>{}))}catch(y){if(b.errors.length==0)throw y}return p}return await ze().watchFiles(e,M,t,y=>{let x=y.map(E=>L.relative(e.cwd,E)),C=y.length;return a.info(`${C} ${C>1?"files":"file"} changed: ${x.join(", ")}`),k(y)}),a.debug("fswatch ended"),!0}if(I){let p=null;W?(a.debug("awaiting eslint"),!v&&!n.diag&&(p=setTimeout(()=>a.info("Waiting for TypeScript... (^C to skip)"),1e3)),W=await I.catch(()=>!1)):(a.debug("cancelling eslint since esbuild reported an error"),I.cancel()),clearTimeout(p)}if(!e.isCancelled&&!W&&Er(),W){let p=await fr();process.exitCode=p}return W}var vr=new Map;function Fn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return a.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(a.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules={...r.tsrules,...o.rules});let i=t.diag&&r.watch&&r.clear,s=me(r),l=`${s||r.cwd}`,u=vr.get(l);if(u)return a.debug(()=>"tslint sharing process (no new process created)"),[u,!0];let c={colors:stdoutStyle.ncolors>0,quiet:r.quiet,mode:n,...o,watch:r.watch,cwd:r.cwd,clearScreen:i,srcdir:at(r.entryPoints[0]),tsconfigFile:s,onRestart(){a.debug("tsc restarting")}};a.debug(()=>`starting tslint with options ${h.repr(c)}`);let m=et(c);return vr.set(l,m),[m,!1]}function Or(e){e.length>0&&a.warn("[warn] "+e.map(t=>t.text).join(`
`))}function On(){return Fr({[We]:1}).catch(e=>{console.error(ie.red(K+": "+(e?e.stack||e:"error")));let t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{let t=process.exitCode||0;process.exit(e||t>0?t:1)})}function Br(){$["no-color"]&&($.color=!1),$["no-diag"]&&($.diag=!1),a.colorMode=$.color,stdoutStyle.reconfigure(process.stdout,$.color),ie.reconfigure(process.stderr,$.color),$.color!==void 0,$["estrella-version"]&&(console.log("estrella 1.3.0"),process.exit(0)),$["estrella-debug"]&&(a.level=a.DEBUG),$.diag&&$.run&&(a.info("Disabling -run since -diag is set"),$.run=void 0),a.debug(()=>`Parsed initial CLI arguments: ${h.repr({options:$,args:V},2)}`)}module.id=="."||process.mainModule&&Tr(process.mainModule.filename||"")=="estrella.js"?([$,V]=Ie(process.argv.slice(2),Cn),Br(),On()):([$,V]=Ie(process.argv.slice(2),{...be,unknownFlagAsArg:!0,help(e,t,r){ut=new Promise(n=>{process.nextTick(()=>{console.log(He(e,be.usage,be.trailer)),process.exit(0),n()})})}}),Br(),V.length>0&&ut.then(()=>{V.length>0&&Ye(V)}),$.parse=(...e)=>{a.debug(()=>`Parsing custom CLI arguments ${h.json(V.join)} via cliopts.parse(`+h.repr(e)+")");let t=Ie(V,{...be,flags:be.flags.concat(e)});return a.debug(()=>"Parsed extra CLI arguments: "+h.json({options:t[0],args:t[1]},2)),V.splice(0,V.length),t});function jr(e,t,r){return ze().watch(e,t,r)}function vn(e,t,r,n){return a.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r={...r,filter:t},r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),jr(e,r,n)}var ct;module.exports={version:"1.3.0",prog:K,cliopts:$,cliargs:V,dirname:at,basename:Tr,watch:jr,watchdir:vn,scandir:yr,tslint:et,defaultTSRules:Qe,termStyle:_e,stdoutStyle,stderrStyle:ie,chmod:R.chmod,editFileMode:R.editMode,fmtDuration:h.fmtDuration,tildePath:h.tildePath,findInPATH:h.findInPATH,tsconfig:xe,tsconfigFile:me,glob:de.glob,globmatch:de.match,file:R,sha1:Ne,log:a,get ts(){return ct===void 0&&(ct=pr()),ct},build:Fr};
//# sourceMappingURL=estrella.js.map
