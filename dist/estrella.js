#!/usr/bin/env node
var Me=Object.defineProperty,Cr=Object.prototype.hasOwnProperty,Pr=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),Tr=e=>Me(e,"__esModule",{value:!0}),vr=(e,t)=>{if(Tr(e),typeof t=="object"||typeof t=="function")for(let r in t)!Cr.call(e,r)&&r!=="default"&&Me(e,r,{get:()=>t[r],enumerable:!0});return e},P=e=>e&&e.__esModule?e:vr(Me({},"default",{value:e,enumerable:!0}),e);var ut=Pr((Pe,lt)=>{!function(e,t){typeof Pe=="object"&&typeof lt!="undefined"?t(Pe):typeof define=="function"&&define.amd?define(["exports"],t):t(e.miniglob={})}(Pe,function(e){"use strict";const{readdirSync:t,statSync:r}=require("fs"),n=(()=>{try{return require("path").sep}catch(i){return"/"}})(),o=n.charCodeAt(0),l=n==":"?/\:+/g:n=="\\"?/\\+/g:/\/+/g,a=process.platform=="win32";class u extends Error{constructor(){super("bad pattern")}}const p=a?i=>{if(i.length<2)return 0;let s=i[0];return i[1]==":"&&("a"<=s&&s<="z"||"A"<=s&&s<="Z")?2:0}:i=>0,g=a?(i,s)=>{const f=s(i);return i==""?[0,"."]:f+1==i.length&&S(i,i.length-1)?[f+1,i]:f==i.length&&i.length==2?[f,i+"."]:(f>=i.length&&(f=i.length-1),[f,i.substr(0,i.length-1)])}:(i,s)=>i==""?[s,"."]:i==n?[s,i]:[s,i.substr(0,i.length-1)];function S(i,s){return i.charCodeAt(s)===o}function O(i,s){i=function(d){let m=d.length-1,y=m;for(;y&&d.charCodeAt(y)===o;)--y;return y!=m&&(d=d.substr(0,y+1)),d.split(l).join(n)}(i);let f=r(i);f.isDirectory()&&function d(m,y,_){for(let I of t(m)){let D=E(m,I),A=T(D),B=y(D,A);(B||B===void 0)&&A&&A.isDirectory()&&!_.has(A.ino)&&(_.add(A.ino),d(D,y,_))}}(i,s,new Set([f.ino]))}function C(i){let s=[];if(!G(i))return T(i)?[i]:s;let f=p(i),d=i.length-1;for(;d>=f&&!S(i,d);)d--;let m=i.substr(0,d+1),y=i.substr(d+1);if([f,m]=g(m,f),G(m.substr(f))){if(m==i)throw new u;const _=C(m);for(let I of _)R(I,y,s)}else R(m,y,s);return s}function R(i,s,f){const d=T(i);if(d===null)return;if(!d.isDirectory())return;let m;try{m=t(i)}catch(y){return}m.sort();for(let y of m)b(s,y)&&f.push(E(i,y))}function G(i){for(let s=0;s<i.length;++s)switch(i.charCodeAt(s)){case 42:case 63:case 91:case 123:return!0}return!1}function j(i,s){for(let f=0;f<i.length;++f)if(i.charCodeAt(f)===s)return!0;return!1}function b(i,s){e:for(;i.length>0;){let f=!1,d="";if([f,d,i]=x(i),f&&d=="")return!j(s,o);let[m,y]=w(d,s);if(!y||!(m.length==0||i.length>0)){if(f){for(let _=0;_<s.length&&s.charCodeAt(_)!=o;_++)if([m,y]=w(d,s.substr(_+1)),y){if(i.length==0&&m.length>0)continue;s=m;continue e}}return!1}s=m}return s.length==0}function x(i){let s=!1;for(;i.length>0&&i.charCodeAt(0)==42;)i=i.substr(1),s=!0;let f=!1,d=0;e:for(;d<i.length;d++)switch(i.charCodeAt(d)){case 92:a||d+1<i.length&&d++;break;case 91:f=!0;break;case 93:f=!1;break;case 42:if(!f)break e}return[s,i.substr(0,d),i.substr(d)]}function w(i,s){for(;i.length>0;){if(s.length==0)return["",!1];switch(i.charCodeAt(0)){case 91:{let d=s.codePointAt(0),m=d<=65535?1:2;if(s=s.substr(m),i=i.substr(1),d.toString(16),i.length==0)throw new u;let y=i.charCodeAt(0)==94;y&&(i=i.substr(1));let _=!1,I=0;for(;;){if(i.length>0&&i.charCodeAt(0)==93&&I>0){i=i.substr(1);break}let D,A;if([A,i,D]=F(i),!D)return["",!1];let B=A;if(i.charCodeAt(0)==45&&([B,i,D]=F(i.substr(1)),!D))return["",!1];A<=d&&d<=B&&(_=!0),I++}if(_==y)return["",!1];break}case 63:if(s.charCodeAt(0)==o)return["",!1];let f=s.codePointAt(0)<=65535?1:2;s=s.substr(f),i=i.substr(1);break;case 92:if(!a&&(i=i.substr(1)).length==0)throw new u;default:if(i.charCodeAt(0)!=s.charCodeAt(0))return i[0],s[0],i.charCodeAt(0).toString(16),s.charCodeAt(0).toString(16),["",!1];s=s.substr(1),i=i.substr(1)}}return[s,!0]}function F(i){let s=0,f="",d=i.charCodeAt(0);if(i.length==0||d==45||d==93)throw new u;if(d==92&&!a&&(i=i.substr(1)).length==0)throw new u;let m=(s=i.codePointAt(0))<=65535?1:2;if(s==65535&&m==1)throw new u;if((f=i.substr(m)).length==0)throw new u;return[s,f,!0]}function T(i){try{return r(i)}catch(s){}return null}function E(i,s){return i=="."||i==""?s:i+n+s}e.PatternError=u,e.glob=function(i){if(i.indexOf("**")<0)return C(i);let s=[],f=new Set;return function d(m,y,_,I,D){_>=y.length&&(_=y.length-1);let A=y[_],B=A;function de(h){return!D.has(h)&&(D.add(h),!0)}function fe(h){let k=h,v=k.lastIndexOf(n);v!=-1&&(k=k.substr(v+1));let $=Math.min(_+1,y.length-1),U=y.slice($).join("*");U.charCodeAt(0)==o?U=function(Le){let Ce=0;for(;Le.charCodeAt(Ce)===o;)Ce++;return Ce!=0?Le.substr(Ce):Le}(U):U[0]!="*"&&(U="*"+U),b(U,k)&&I.push(h)}_===0?A.charCodeAt(A.length-1)!=o&&(B+="*"):_===y.length-1?A.charCodeAt(0)!=o&&(B="*"+B):(A.charCodeAt(0)!=o&&(B="*"+B),A.charCodeAt(A.length-1)!=o&&(B+="*")),m&&(B=B[0]!=n?m+n+B:m+B);let Se=!1;B.charCodeAt(B.length-1)===o&&(Se=!0,B=function(h){let k=h.length-1,v=k;for(;h.charCodeAt(v)===o;)v--;return v!=k?h.substr(0,v+1):h}(B));let Ne=C(B);for(let h of Ne){let k=r(h);k.isDirectory()?de(h)&&O(h,(v,$)=>{de(v)&&($.isDirectory()?d(v,y,_+1,I,D):fe(v))}):!Se&&de(h)&&fe(h)}return I}("",i.split(/\*{2,}/),0,s,f),s},e.match=b,Object.defineProperty(e,"__esModule",{value:!0})})});function ct(e,t,r){}ct.throws=!1;global.assert=ct;function dt(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function Te(e,t){return ft(dt(e,t),t)}function ft(e,t){const r=l=>`[${l}m`,n=e>0||t?(l,a)=>{const u=r(l),p=r(a);return g=>u+g+p}:l=>a=>a,o=e>=8?(l,a,u)=>{let p="["+a+"m",g="["+u+"m";return S=>p+S+g}:e>0?(l,a,u)=>{let p="["+l+"m",g="["+u+"m";return S=>p+S+g}:(l,a,u)=>p=>p;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(l,a){const u=dt(l,a);return u!=this.ncolors&&a!=this._hint&&Object.assign(this,ft(u,a)),this}}}const N=Te(process.stdout),X=Te(process.stderr);const ie=P(require("fs")),ee=P(require("path")),De=P(require("os")),pt=P(require("perf_hooks")),mt=P(require("util")),L=(e,t,r)=>JSON.stringify(e,r,t),le=()=>pt.performance.now(),pe=Symbol("TYPE"),gt=eval("require");function z(e,t){let r={colors:N.ncolors>0};return typeof t=="object"?r={...t}:t!==void 0&&(r.compact=!t),mt.inspect(e,r)}function We(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function ht(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function ve(e){const t=process.platform.startsWith("win")&&!/\.exe$/i.test(e);for(let r of(process.env.PATH||"").split(ee.delimiter)){let n=ee.join(ee.resolve(r),e);for(;;){try{let o=ie.statSync(n);if(o.isSymbolicLink()){n=ie.realpathSync.native(n);continue}else if(o.isFile()&&o.mode&ie.constants.X_OK)return n}catch(o){}break}}return null}function Ge(e,t){const r=require("vm");return r.runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}function bt(e){return Ge(ie.readFileSync(e,"utf8"),e)}function yt(e){const t=De.homedir();return e=="~"?t:e.startsWith("~"+ee.sep)?t+e.substr(1):e}function se(e){const t=ee.resolve(e),r=De.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}const H=P(require("path")),J=(()=>{const e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!H.isAbsolute(e))return e;let r="";if(e){const n=H.basename(process.execPath);e.endsWith(H.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=H.relative(process.cwd(),t);if(!n.startsWith("node_modules"+H.sep)&&n.indexOf(H.sep+"node_modules"+H.sep)==-1)return H.sep=="/"&&(n="./"+n),n}return r+H.basename(t)})();function ke(e,t){let[r,n]=kr(t.flags.filter(g=>g)),o={},l=!1,a=[],u=0;const p=()=>{a.push(e.splice(u,1)[0]),u--};for(;u<e.length;u++){let g=e[u];if(g=="--"){u++;break}if(g[0]!="-"){p();continue}g=g.replace(/^\-+/,"");let S=g.indexOf("="),O;S!=-1&&(O=g.substr(S+1),g=g.substr(0,S));let C=r.get(g);if(!C){if(g=="h"||g=="help")l=!0,t.help||(console.log(ze(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){p();continue}else Ue([e[u]]);break}let R=!0;if(C.valueName){if(O===void 0)if(O=e[u+1],O!==void 0&&O[0]!="-")u++;else{console.error(`missing value for option -${g} (see ${J} -help)`),process.exit(1);break}try{R=C.valueParser?C.valueParser(O):O}catch(G){console.error(`invalid value for option -${g} (${G.message})`)}}else O!==void 0&&(console.error(`unexpected value provided for flag -${g}`),process.exit(1));o[g]=R;for(let G of C.names){if(G==g)continue;o[G]=R}}return u<e.length&&(a=a.concat(e.slice(u))),l&&t.help&&t.help(n,o,a),[o,a]}function Ue(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${J} -help)`),process.exit(1)}function kr(e){let t=new Map,r=[];for(let n of e){let o=Er(n);r.push(o);for(let l of o.names){if(t.has(l))throw new Error(`duplicate CLI flag ${L(l)} in definition ${L(n)}`);t.set(l,o)}}return[t,r]}function Er(e){const t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,l]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(l)switch(l.toLowerCase()){case"string":case"str":l="string";break;case"bool":case"boolean":l="boolean",n.valueParser=a=>(a=a.toLowerCase(),a!="false"&&a!="0"&&a!="no"&&a!="off");break;case"number":case"num":case"float":case"int":l="number",n.valueParser=a=>{let u=Number(a);if(isNaN(u))throw new Error(`${L(a)} is not a number`);return u};break;default:throw new Error(`invalid argument type "${l}"`)}else l="string";n.valueName=o||l,n.valueType=l}return n}function ze(e,t,r){let n={prog:J,"0":J};const o=a=>a.replace(/\$(\w+)/g,(u,p)=>{let g=n[p];if(!g)throw new Error(`unknown variable $${p} (to print a dollar sign, use '\\$')`);return g});let l=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){l+=`
options:
`;let a=0,u=[];for(let p of e){let g="  -"+(p.valueName?p.names.join("=,-")+"="+(p.valueType=="boolean"?"on|off":"<"+p.valueName+">"):p.names.join(", -"));a=Math.max(a,g.length),u.push(g)}for(let p=0;p<e.length;p++){let g=e[p],S=u[p],O=g.description;g.description||(O=g.valueType?"Set ":"Enable "+g.names.reduce((C,R)=>R.length>C.length?R:C,"")),l+=`${S.padEnd(a," ")}  ${O}`,p+1<e.length&&(l+=`
`)}}return r&&(l+=`
`+o(r.replace(/[\n\s]+$/,""))),l}const wt=P(require("console"));var te;(function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(te||(te={}));let me=console,qe;const Ee=new class{constructor(){this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=Ir}error(...t){Ie(t),me.error(X.red(`${J}:`),...t)}warn(...t){Ee.level>=1&&(Ie(t),me.error(X.magenta(`${J}:`),...t))}info(...t){Ee.level>=2&&(Ie(t),me.log(...t))}get colorMode(){return qe}set colorMode(t){if(qe===t)return;qe=t,t===void 0?me=console:me=new wt.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t})}};var c=Ee;function Ie(e){typeof e[0]=="function"&&(e[0]=e[0]())}function Ir(...e){if(Ee.level>=3){let t="";if(Ie(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;me.log(N.bold(N.blue(`[DEBUG${t}]`)),...e)}}const xt=P(require("path"));let _r=__dirname;function St(e){let t=null;return function(){return t||(c.debug(`loading ${e} module`),t=gt(xt.join(_r,e))),t}}const ge=St("debug.js"),Ke=St("watch.js");class ue extends Error{constructor(e){super(e);this.name="UserError"}}function Ct(e,t){return ge().bugReportMessage(e,t)}function Pt(e,t){return ge().printErrorAndExit(e,t)}function Tt(e,t){Error.prepareStackTrace=void 0;try{if(ge().installSourceMapSupport(),Error.prepareStackTrace!==Tt)return Error.prepareStackTrace(e,t)}catch(r){}return e.stack||String(e)}Error.prepareStackTrace=Tt;process.on("uncaughtException",Pt);process.on("unhandledRejection",(e,t)=>{Pt(e||"PromiseRejection","unhandledRejection")});const Pn=new Map,Tn=Symbol("isMemoized");const vt=!!process.stdout.isTTY,Or=!!process.stderr.isTTY,re={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((re.width-1)/e.length))}};if(vt||Or){const e=vt&&process.stdout||process.stderr,t=()=>{re.width=e.columns,re.height=e.rows};e.on("resize",t),t(),re.clear=()=>{e.write("c")}}const K=P(require("path")),kt=P(require("fs")),Et=Symbol("TS_CONFIG_FILE"),It=Symbol("TS_CONFIG"),{dirname:Fr,basename:_n}=K;function _t(e){let t="",r=process.cwd();e&&process.chdir(e);try{t=require.resolve("typescript")}catch(n){}finally{e&&process.chdir(r)}if(t){const n=K.sep+"node_modules"+K.sep;let o=t.indexOf(n);if(o!=-1)return K.join(t.substr(0,o+n.length-K.sep.length),".bin","tsc")}return"tsc"}function Ye(e,t){for(let r of He(e,t))try{const n=kt.statSync(r);if(n.isFile())return r}catch(n){}return null}function*He(e,t){e=K.resolve(e);const r=K.parse(e).root;for(t=t?K.resolve(t):r;!(yield K.join(e,"tsconfig.json"),e==t);)if(e=Fr(e),e==r)break}function Je(e){let t=e.cwd||process.cwd();return e.entryPoints&&e.entryPoints.length>0&&(t=K.resolve(t,K.dirname(e.entryPoints[0]))),t}function he(e){let t=e[Et];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=Je(e);t=Ye(r,e.cwd)}Object.defineProperty(e,Et,{value:t})}return t}function ye(e){let t=e[It];if(t===void 0){const r=he(e);if(r)try{t=bt(r)}catch(n){c.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,It,{value:t})}return t}const we=P(require("path")),Fn=P(require("fs")),Ot=P(require("child_process")),{dirname:Br,basename:Mn}=we,Ve={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},Ft=0,Bt=1,Rt=2,Rr=3,jt={IGNORE:Ft,INFO:Bt,WARNING:Rt,ERROR:Rr};function At(e,t){for(let r of Object.keys(t)){let n=jt[String(t[r]).toUpperCase()];if(n===void 0)throw new ue(`Invalid value for TS rule ${r}: ${L(n)} -- expected value to be one of: `+Object.keys(jt).map(L).join(", "));e[r]=n}}function Xe(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);const l=e.quiet?()=>{}:console.log.bind(console),a=e.cwd||process.cwd();let u=e.tsconfigFile;if(u===void 0&&(u=Ye(e.srcdir?we.resolve(a,e.srcdir):a)),e.mode!="on"&&!u)return n(!0);const p=e.format?e.format.toLowerCase():"",g=p.startsWith("short"),S=p.startsWith("short"),O=p=="short-all";let C=_t(e.cwd);if(C=="tsc"&&e.mode!="on"&&!(C=ve(C)))return console.warn(X.orange(prog+":")+" tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+we.relative(process.cwd(),Br(u))+"."` Set tslint options.tslint="off" or pass -no-diag on the command line.`),n(!0);const R={};At(R,Ve),e.rules&&At(R,e.rules);let G=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",u&&"--project",u].concat(e.args||[]).filter(h=>h);c.debug(()=>`spawning process ${C} ${L(G,2)}`);const j=Ot.spawn(C,G,{stdio:["inherit","pipe","inherit"],cwd:a}),b=()=>{try{j.kill()}catch(h){}};process.on("exit",b),t.cancel=()=>{j.kill()};const x=h=>h,w=N.orange,F=N.red,T=N.green,E=Buffer.from(" TS"),i=Buffer.from("Found "),s=Buffer.from("c"),f=Buffer.from("tarting compilation"),d=Buffer.from("tarting incremental compilation"),m=[];let y=0,_=!1,I={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},D=!1;function A(){if(!e.quiet||I.errors>=0){e.watch&&console.log(re.banner("â€”"));let h=[];I.errors>0?h.push(F("TS: "+fe("$ error","$ errors",I.errors))):h.push(T("TS: OK")),I.warnings>0&&h.push(w(fe("$ warning","$ warnings",I.warnings))),I.other>0&&h.push(fe("$ message","$ messages",I.other)),console.log(h.join("   ")),e.watch&&console.log(re.banner("â€”"))}_=I.errors>0,e.onEnd&&e.onEnd(I),I.reset(),D=!0}function B(h){let k=m.slice();if(m.length=0,y==0){let v=0,$=k[v++];for(;$.length==0||$[0]==10&&v<k.length;)$=k[v++];if($.includes(f)||$.includes(d))return I.reset(),h&&A();if(k.every(U=>U.length<=1))return h&&A()}else{const v=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g;let $=k.shift().toString("utf8");switch(R[y]){case Ft:return h&&A();case Bt:$=$.replace(v,x("info")),g?k=[]:de(k,x),I.other++;break;case Rt:$=$.replace(v,w("warning")),S?k=[]:de(k,w),I.warnings++;break;default:O&&(k=[]),v.test($)?I.errors++:I.other++;break}process.stdout.write($)}k.forEach(v=>process.stdout.write(v)),h&&A()}function de(h,k){for(let v=1;v<h.length;v++){let $=h[v];if($.includes(126)){let U=$.toString("utf8");U=U.replace(/\x1b\[\d+m(\s*~+)/g,k("$1")),h[v]=U}}}function fe(h,k,v){return(v==1?h:k).replace(/\$/g,v)}jr(j.stdout,(h,k)=>{if(e.clearScreen||(h=Ne(h)),k){h.length>0&&m.push(h),m.length>0&&B();return}if(D&&h.length>1&&(D=!1,e.onRestart&&e.onRestart()),h.includes(i)){let v=Se(h.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(v)){B(!0),y=0;return}else B(!1);y=0}else if(h.includes(E)){const v=h.toString("utf8"),$=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(v);let U=$?parseInt($[1]):0;U>0&&!isNaN(U)&&(m.length>0&&B(),y=U)}m.push(h)}),j.on("close",h=>{process.removeListener("exit",b),n(!_)});function Se(h){return h.replace(/\x1b\[\d+m/g,"")}function Ne(h){let k=h.indexOf(s);return k==-1?h:k==0?h.subarray(3):Buffer.concat([h.subarray(0,k),h.subarray(k+3)],h.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}const Ar=Buffer.allocUnsafe(0);function jr(e,t){let r=[],n=0;const o=a=>{let u=0;for(;;){let p=a.indexOf(10,u);if(p==-1){if(u<a.length-1){const S=a.subarray(u);r.push(S),n+=S.length}break}p++;let g=a.subarray(u,p);n>0&&(g=Buffer.concat(r.concat(g),n+g.length),r.length=0,n=0),t(g,!1),u=p}},l=()=>{r.length>0?t(Buffer.concat(r,n),!0):t(Ar,!0)};e.on("data",o),e.on("close",l),e.on("end",l)}const $r=P(require("fs"));function $t(e){return e&&e.read}function Nt(e){return e&&e.write}const Ze=Buffer.allocUnsafe(0);function Lt(e){return e&&typeof e=="object"&&e[pe]=="Reader"}function _e(e){return e?new Lr(e):Nr}function Qe(e){return e?{[pe]:"Writer",stream:e}:Mr}var Un;const Nr=new class{constructor(){this[Un]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(Un=pe,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}};var zn,Mt;const Mr=new(Mt=class{constructor(){this[zn]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},zn=pe,Mt);var qn;class Lr{constructor(e){this[qn]="Reader";this._ended=!1;this.stream=e,e.pause(),e.once("end",()=>{this._ended=!0})}[(qn=pe,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(e,t){const r=this.stream;if(r.pause(),typeof e=="string")t=e,e=Number.MAX_SAFE_INTEGER;else if(e==null||e<0)e=Number.MAX_SAFE_INTEGER;else if(e==0)return t?"":Ze;if(r.readable){let a=r.read(this._ended?void 0:e);if(a)return t?a.toString(t):a}if(this._ended)return t?"":Ze;const n=[];let o=0;if(r.readable){const a=r.read();a&&(n.push(a),o+=a.length)}for(;o<e&&!this._ended;){await new Promise((u,p)=>{r.once("error",p),r.once("end",u),r.once("readable",u)});let a=r.read(e-o);a||(a=r.read()),a&&(n.push(a),o+=a.length)}const l=Dt(n);return t?l.toString(t):l}}function Dt(e,t){return e.length==0?Ze:e.length==1?e[0]:Buffer.concat(e,t)}function et(){const e=[];let t=0;const r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>Dt(e,t),e}function tt(e){const t=ge().libuv_errors;return t[e]||""}function Wt(e,t,r){const n=setTimeout(()=>{const o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}const Z=P(require("fs")),Gt=P(require("os")),Ut=P(require("child_process")),zt=P(require("stream")),qt="process not started";class rt{constructor(e,...t){this.dir="";this.env={...process.env};this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=e=>{c.debug(()=>`${this} error:
${e.stack||e}`),this._reject(e)};this._onexit=(e,t)=>{const r=this;c.debug(()=>`${r} exited status=${e} signal=${t}`),r.running=!1,e===null||t!==null?(assert(typeof t=="string"),r.exitCode=-(Gt.constants.signals[t]||1)):r.exitCode=e||0,r._resolve(r.exitCode)};this.command=e,this.args=t,this.promise=Promise.reject(new Error(qt)),this.promise.catch(r=>{})}start(){return null}run(e){return this.start(),this.wait(e)}output(e,t){this.stdout="pipe",this.stderr||(this.stderr="pipe");const{stdout:r,stderr:n}=this.start(),o=et(),l=et();return r.stream.on("data",a=>{o.push(a)}),n&&n.stream.on("data",a=>{l.push(a)}),this.wait(t||0).then(a=>{if(a!=0){let p="";const g=l.buffer();try{p=g.toString("utf8")}catch(S){p=g.toString("ascii")}throw p.length>0&&(p=`. stderr output:
`+p),new Error(`command exited with status ${a}${p}`)}const u=o.buffer();return e?u.toString(e):u})}wait(e,t){return e===void 0||e<=0?this.promise:this._waitTimeout(e,(r,n,o)=>(c.debug(()=>`${this} wait timeout reached; killing process`),r.message="Cmd.wait timeout",this.kill(t).then(()=>o(r))))}signal(e,t){const r=this._checkproc();if(t=="group")try{return process.kill(-r.pid,e),!0}catch(n){}return r.kill(e)}async kill(e="SIGTERM",t=500,r){const n=this._checkproc();return this.signal(e,r||"group")?t<=0?this.promise:this._waitTimeout(t,(o,l)=>(c.debug(()=>`${this} kill timeout reached; sending SIGKILL`),n.kill("SIGKILL"),this.promise.then(l))):n.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(qt);return this.process}_rejectAndKill(e){this._reject(e)}_waitTimeout(e,t){return new Promise((r,n)=>{let o=!1;return this.promise.then(l=>{o||r(l)}),Wt(this.promise,e,l=>{o=!0,t(l,r,n)})})}}rt.prototype.start=function(){const t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((a,u)=>{t._resolve=a,t._reject=u});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":Lt(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;const o=Ut.spawn(t.command,t.args,{stdio:[r,t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?yt(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!0});if(o.pid===void 0){t.process=null,t.pid=0;const a=Dr(t);throw t._reject(a),a}if(t.running=!0,t.process=o,t.pid=o.pid,o.on("exit",t._onexit),o.on("error",t._reject),c.debug(()=>`${t} started (${z(t.command)})`),o.stdin)if(t.stdin instanceof Buffer){const a=new zt.PassThrough;a.end(t.stdin),a.pipe(o.stdin),o.stdin=null}else n&&(n.pipe(o.stdin),o.stdin=null);if(!o.stdin&&!o.stdout&&!o.stderr&&o.stdio.length<4)return null;const l={stdin:o.stdin?Qe(o.stdin):null,stdout:o.stdout?_e(o.stdout):null,stderr:o.stderr?_e(o.stderr):null,extraFiles:o.stdio.slice(3).map(a=>$t(a)?_e(a):Nt(a)?Qe(a):null)};return l};function Dr(e){let t="",r="unspecified error";if(e.shell==!1){try{Z.accessSync(e.dir,Z.constants.R_OK|Z.constants.X_OK);const o=Z.statSync(e.command);(o.mode&Z.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=tt(t)||r}if(!t){try{Z.accessSync(e.dir,Z.constants.R_OK|Z.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=tt(t)||r,t&&(r=r+"; cmd.dir="+z(e.dir))}t||(t="UNKNOWN");const n=new Error(`failed to spawn process ${z(e.command)} (${t} ${r})`);return n.code=t,n}const nt=P(require("fs")),Kt=P(require("os")),Ht=new Map;function xe(e,t){const r=o=>nt.writeSync(process.stderr.fd,o+`
`);let n=Ht.get(e);if(n)n.listeners.add(t);else{const o=new Set([t]),l=a=>{a=="SIGINT"&&nt.writeSync(1,`
`);try{for(let u of o)u(a)}catch(u){r(`error in signal listener: ${u.stack||u}`)}process.exit(-(Kt.constants.signals[a]||1))};process.on(e,l),Ht.set(e,{rootListener:l,listeners:o})}}const Yt=P(require("path")),Jt=P(require("fs"));let Vt=!1,Xt=!1,Oe=new Set;function Wr(){if(Vt)return;Vt=!0,process.on("beforeExit",t=>ot(!1)),process.on("exit",t=>ot(!1));const e=t=>ot(!1);xe("SIGINT",e),xe("SIGHUP",e),xe("SIGTERM",e),xe("SIGPIPE",e)}function ot(e){if(Xt)return;Xt=!0;const t=r=>Jt.writeSync(process.stderr.fd,r+`
`);try{if(!1)for(let n of Oe);for(let r of Oe)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch(n){}Oe.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function Zt(e){if(!e.run)return;c.debug(()=>`run.configure run=${z(e.run)}`);const t=new Gr(e);Oe.add(t);const r=e.onEnd;e.onEnd=async(n,o,l)=>{if(await t.onEndBuild(o),typeof r=="function")return r(n,o,l)},Wr()}function Qt(){return Promise.all(Array.from(Oe).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}class Gr{constructor(e){this._logOnExit=!0;if(this.config=e,this.cmd=new rt(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.2.3",typeof e.run=="string")this.cmd.command=e.run,this.cmd.shell=!0,this.cmdname=e.run;else if(typeof e.run=="boolean"){if(!e.outfile)throw new ue("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[Yt.resolve(e.outfile)],this.cmdname=e.outfile}else{if(!e.run||e.run.length==0)throw new ue("config.run is an empty list");this.cmd.command=e.run[0],this.cmd.args=e.run.slice(1),this.cmdname=e.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(e){if(e.errors.length>0)return;const t=this.cmd,r=N.pink,n=t.running;t.running&&(this._logOnExit=!1,c.debug(()=>`Stopping ${this.cmdname} [${t.pid}] ...`),await t.kill());let{stdout:o}=t.start();this.config.watch&&(c.info(()=>r(`${n?"Restarted":"Running"} ${this.cmdname} [${t.pid}]`)),this._logOnExit=!0,t.promise.then(l=>{this._logOnExit&&c.info(()=>r(`${this.cmdname} exited (${l})`))}))}}function er(e){let t=e;if(!t){c.debug("typescript API requested; attempting to load typescript module");try{const b=require;if(t=b("typescript"),parseFloat(t.versionMajorMinor)<3.5)return c.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;c.debug(()=>`loaded typescript ${t.version} from ${se(b.resolve("typescript"))}`)}catch(b){return c.debug(()=>"failed to load typescript; module unavailable"),null}}const r=new Map;function n(b){const x=L(Object.keys(b).sort().map(E=>[E,b[E]])),w=r.get(x);if(w)return c.debug("ts.getCompilerHost cache hit"),w;b={newLine:t.NewLineKind.LineFeed,...b};const F=t.createCompilerHost(b,!0),T=[F,b];return r.set(x,T),c.debug("ts.getCompilerHost cache miss"),T}async function o(b,x){const w=typeof b=="string"?{"/<source>/a.ts":b}:b,F=Object.keys(w),[T,E]=n(x||{}),i=T.readFile;T.readFile=d=>d in w?w[d]:i(d);const s=t.createProgram(F,E,T);if(typeof b=="string")return s.getSourceFile(F[0]);const f={};for(let d of F)f[d]=s.getSourceFile(d);return f}async function l(b,x){return a(b,x)}function a(b,x){const[w,F]=n(x||{}),T=t.createProgram([b],F,w),E=T.getSourceFile(b);if(!E)throw new Error(`${b}: file not found`);return E}function u(b,x,w){return p(b,[x],w).then(F=>F[0])}async function p(b,x,w){const F=a(b,w);return g(F,x)}function g(b,x){const w=R(b),F=new Map,T=[];for(let E of x||w.keys()){const i=w.get(E);if(!i){T.push(null);continue}T.push(S(b,i,w,F))}return T}function S(b,x,w,F){const T=F.get(x);if(T)return T;const E={heritage:[],name:x.name.escapedText,props:{},computedProps(){const i={};for(let s of E.heritage)Object.assign(i,s.props);return Object.assign(i,E.props),i},lookupProp(i){let s=E.props[i];if(!s){for(let f of E.heritage)if(s=f.lookupProp(i))break}return s}};if(F.set(x,E),x.heritageClauses)for(let i of x.heritageClauses)for(let s of i.types){const f=s.expression;if(t.isIdentifier(f)){const d=w.get(f.escapedText);d&&E.heritage.push(S(b,d,w,F))}}return x.forEachChild(i=>{if(t.isPropertySignature(i)){const s=O(i,b,E);E.props[s.name]=s}}),E}function O(b,x,w){const F=t.getLineAndCharacterOfPosition(x,b.pos);let T=null;const E=b.type,i=C(b.name),s={name:i,type:E,get typestr(){return T===null&&(T=E?j(E,x):"any"),Object.defineProperty(s,"typestr",{enumerable:!0,value:T}),T},srcfile:x.fileName,srcline:F.line,srccol:F.character,parent:w};return s}function C(b){switch(b.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return b.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return b.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function R(b){const x=new Map;return t.forEachChild(b,w=>{w.kind==t.SyntaxKind.InterfaceDeclaration&&x.set(w.name.escapedText,w)}),x}const G=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function j(b,x){if(!x){let w=b;for(;w.kind!=t.SyntaxKind.SourceFile;)if(w=w.parent,!w)throw new Error("node without SourceFile parent (provide file to ts.fmt)");x=w}return G.printNode(t.EmitHint.Unspecified,b,x)}return{ts:t,getCompilerHost:n,parse:o,parseFile:l,interfaceInfo:u,interfacesInfo:p,interfacesInfoAST:g,fmt:j}}const ne=P(require("fs")),tr=String.fromCharCode,Ur=(e,t)=>e.charCodeAt(t||0);function rr(e,t){if(typeof t=="number")return ne.chmodSync(e,t),t;let r=ne.statSync(e).mode,n=Fe(r,t);return r!=n&&ne.chmodSync(e,n),n}function nr(e,t){return new Promise((r,n)=>{if(typeof t=="number")return ne.chmod(e,t,o=>{o?n(o):r(t)});ne.stat(e,(o,l)=>{if(o)return n(o);let a=Fe(l.mode,t);if(l.mode==a)return r(a);ne.chmod(e,a,u=>{u?n(u):r(a)})})})}function Fe(e,t){const r="Expected format: [ugoa]*[+-=][rwx]+",n=(l,a)=>new Error(`${l} in modifier ${L(a)}. ${r}`);let o=[];for(let l of Array.isArray(t)?t:[t])o=o.concat(l.trim().split(/\s*,+\s*/));for(let l of o){let a=[],u=!1,p=0,g=0;for(let O=0;O<l.length;O++){let C=Ur(l,O);if(p==0)switch(C){case 117:case 103:case 111:u||a.push(C);break;case 97:a=[117,103,111],u=!0;break;case 43:case 45:case 61:p=C;break;default:if(p==0)throw n(`Invalid target or operation ${L(tr(C))}`,l);break}else switch(C){case 114:g|=4;break;case 119:g|=2;break;case 120:g|=1;break;default:throw n(`Invalid permission ${L(tr(C))}`,l)}}if(p==0)throw n("Missing operation",l);a.length==0&&(a=[117]),g==0&&(g=4|2|1);let S=0;for(let O of a)switch(O){case 117:S|=g<<6;break;case 103:S|=g<<3;break;case 111:S|=g;break}switch(p){case 43:e|=S;break;case 45:e&=~S;break;case 61:e=S;break}}return e}const oe=P(require("fs")),Y=P(require("path")),or=P(require("crypto")),Q=oe.promises,zr={};function Be(e){zr[Y.resolve(String(e))]=le()}function q(e,t){return Q.readFile(e,t)}q.editMode=Fe;q.chmod=(e,t)=>(Be(e),nr(e,t));function qr(e,t){return Q.readFile(e,t)}q.read=qr;q.stat=Q.stat;function Kr(...e){return Promise.all(e.map(t=>Q.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}q.mtime=Kr;q.readall=(...e)=>Promise.all(e.map(t=>Q.readFile(t)));q.readallText=(e,...t)=>Promise.all(t.map(r=>Q.readFile(r,{encoding:e||"utf8"})));q.write=async(e,t,r)=>{Be(e);const n=r&&typeof r=="object"?r:{};try{await Q.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await q.mkdirs(Y.dirname(String(e)),n.mkdirMode),await Q.writeFile(e,t,r);else throw o}if(n.log){let o=Y.relative(process.cwd(),String(e));o.startsWith(".."+Y.sep)&&(o=se(e)),c.info(N.green(`Wrote ${o}`))}};function Hr(e,t){return new Promise((r,n)=>{const o=oe.createReadStream(e),l=or.createHash("sha1");o.on("error",n),o.on("end",()=>{l.end(),r(t?l.digest(t):l.digest())}),o.pipe(l)})}q.sha1=Hr;q.copy=(e,t,r)=>{let n=oe.constants.COPYFILE_FICLONE;return r&&(n|=oe.constants.COPYFILE_EXCL),Be(t),Q.copyFile(e,t,n)};q.move=(e,t)=>(Be(t),Q.rename(e,t));q.mkdirs=(e,t)=>Q.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function ir(e,t,r){if(r||(r={}),!oe.promises||!oe.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");const n=[],o=new Set,l=r.recursive!==void 0?r.recursive?Infinity:0:r.depth!==void 0?r.depth:Infinity;async function a(p,g,S){if(o.has(p))return;o.add(p);const O=await oe.promises.opendir(p);for await(const C of O){let R=C.name;C.isDirectory()?l<S&&await a(Y.join(p,R),Y.join(g,R),S+1):(C.isFile()||C.isSymbolicLink())&&(t&&t.test(R)&&n.push(Y.join(g,R)))}}const u=Array.isArray(e)?e:[e];return Promise.all(u.map(p=>a(Y.resolve(p),".",0))).then(()=>n.sort())}const sr={version:"0.7.7",BuildOptions:new Set(["sourcemap","format","globalName","target","strict","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","jsxFactory","jsxFragment","define","pure","color","logLevel","errorLimit","bundle","splitting","outfile","metafile","outdir","platform","external","loader","resolveExtensions","mainFields","write","tsconfig","outExtension","entryPoints","stdin"])},ar={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])};const lr=P(require("crypto"));function Re(e,t){const r=lr.createHash("sha1").update(e);return t?r.digest(t):r.digest()}const je=P(require("path"));function ur(e,t){let r="",n=!1,o=!1;const l=Object.create({get projectID(){if(!r){const a=[l.cwd,l.outfile||"",...Array.isArray(l.entryPoints)?l.entryPoints:l.entryPoints?[l.entryPoints]:[]].join(je.delimiter);r=Yr(Re(Buffer.from(a,"utf8")))}return r},get buildIsCancelled(){return n},set buildIsCancelled(a){n=a},get outfileIsTemporary(){return o},set outfileIsTemporary(a){o=a}});return Object.assign(l,e),l.cwd=l.cwd?je.resolve(l.cwd):t,l}function Yr(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}const cr=P(require("esbuild")),ae=P(require("fs")),Ae=P(require("os")),W=P(require("path")),ce=P(ut()),{dirname:it,basename:dr}=W,be={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},Jr={usage:"usage: $0 [options] <srcfile> ...",flags:be.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `};let st=Promise.resolve(),M={},V=[];const $e=Symbol("IS_MAIN_CALL");let fr=!1;function pr(e){if(!fr){fr=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function Vr(e){if(c.debug(()=>`input config ${z(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry&&(Array.isArray(e.entry)?e.entryPoints=e.entryPoints.concat(e.entry):e.entryPoints.push(e.entry)),delete e.entry,e.entryPoints.length==0&&(c.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=mr(e),e.entryPoints.length==0)){let t=ye(e)?" (could not guess from tsconfig.json)":"";throw new ue(`config.entryPoints is empty or not set${t}`)}e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,c.debug(()=>`effective config for project#${e.projectID}: ${z(e)}`)}function Xr(e,t){const r=JSON.parse(ae.readFileSync(e));for(let n in t){const o=t[n];o===void 0?delete r[n]:r[n]=o}ae.writeFileSync(e,JSON.stringify(r))}function mr(e){const t=ye(e);if(t){if(c.debug(()=>`tsconfig file found at ${he(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)c.debug(`guessing entry points: glob.glob(${n}) =>`,ce.glob(n)),r=r.concat(ce.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!ce.match(n,o));return r.slice(0,1)}}return[]}function Zr(e){let t={},r={};const n={name:"globalName"};for(let o of Object.keys(e)){if(ar.BuildConfig.has(o))continue;sr.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]}return Object.keys(r).length>0&&c.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${z(r)}
`+Ct("guess",L(Object.keys(r)))),t}let gr=new Set;function Qr(...e){if(c.level>=c.INFO){const t=e.join(" ");gr.has(t)||(gr.add(t),c.info(...e))}}function hr(e){e=ur(e||{},e[$e]?process.cwd():process.mainModule&&it(process.mainModule.filename)||__dirname);const t={resolve(){},reject(){}},r=[];function n(u){e.isCancelled?u():r.push(u)}function o(u){if(!e.isCancelled){c.debug("build cancelled",{reason:u}),e.isCancelled=!0;for(let p of r)p&&p();r.length=0,u?t.reject(u):t.resolve()}}let l={addCancelCallback:n,buildCounter:0,rebuild(){return c.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}};const a=st.then(()=>new Promise((u,p)=>{if(e.isCancelled)return c.debug("build cancelled immediately"),!1;t.resolve=u,t.reject=p,en(e,l).then(u).catch(p)}));return a.rebuild=()=>l.rebuild(),Object.defineProperty(a,"buildCounter",{get(){return l.buildCounter}}),a.cancel=o,a}async function en(e,t){const r=$e in e;delete e[$e];let n=M,o=V;if(e.run===void 0&&(e.run=n.run),!r)e={...e},Vr(e);else{if(o.length==0){const s=mr(e);c.debug(()=>`no input files provided; best guess: ${z(s)}`),s.length==0&&(c.error(`missing <srcfile> argument (see ${J} -help)`),process.exit(1)),o.splice(o.length-1,0,...s);const f=ye(e);!n.outfile&&!n.outdir&&f&&(n.outfile=f.outFile,n.outfile||(n.outdir=f.outDir)),o.length==0&&(c.error(`missing <srcfile> argument (see ${J} -help)`),process.exit(1))}if(n.outfile=="-"||!n.outfile&&!n.outdir){n.outfile="-";const s=e.projectID;n.outfile=W.join(Ae.tmpdir(),`esbuild.${s}.out.js`),e.outfileIsTemporary=!0}if(e.entryPoints=o,e.outfile=n.outfile||void 0,e.outdir=n.outdir||void 0,e.bundle=n.bundle||void 0,e.minify=n.minify||void 0,n.esbuild){const s=Ge(n.esbuild,"-esbuild");if(!s||typeof s!="object")return c.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof s}.`),!1;c.debug(()=>`applying custom esbuild config ${z(s)}`);for(let f in s)e[f]=s[f]}}const l=e.debug=n.debug=!!(n.debug||e.debug),a=e.quiet=n.quiet=!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(c.colorMode=e.color,N.reconfigure(process.stdout,e.color),X.reconfigure(process.stderr,e.color)),a&&(c.level=c.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,c.debug(()=>`project directory ${z(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||se(e.cwd));let u=n.diag===!0?"on":n.diag===!1?"off":"auto";if(u!=="off"){e.tsc!==void 0&&(c.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(u=e.tslint);const s=u==="auto"||typeof u=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode);s?he(e)||(c.debug(()=>{const f=Je(e),d=Array.from(He(f,e.cwd));return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${d.map(m=>`
  ${se(m)}`)}`}),u="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(u=e.tslint)}e.run&&Zt(e);let p=0;function g(){re.clear(),p=le()}let S=!1;const O=e.onEnd;let C=O?async(s,f)=>{S=!0;let d;try{const m=O(e,s,t);d=m instanceof Promise?await m:m}catch(m){throw c.debug(()=>`error in onEnd handler: ${m.stack||m}`),m}finally{S=!1}return yr(s&&s.errors?s.errors:[]),d===void 0?f:!!d}:(s,f)=>(yr(s&&s.errors?s.errors:[]),f);function R(s){let f=C;C=async(d,m)=>{const y=await s(d,m);return y!==void 0&&(m=y),f(d,m)}}e.outfileMode&&e.outfile&&R(async(s,f)=>{try{rr(e.outfile,e.outfileMode)}catch(d){c.error("configuration error: outfileMode: "+d.message),pr(1)}}),e.outfileIsTemporary&&!e.run&&R(async(s,f)=>new Promise((d,m)=>{const y=ae.createReadStream(e.outfile);y.on("end",()=>d(f)),y.on("error",m),y.pipe(process.stdout)})),e.watch&&R(async(s,f)=>{Qr("Watching files for changes...")});let G={DEBUG:l,...e.define||{}};for(let s in G)G[s]=L(G[s]);const j={minify:!l,sourcemap:e.sourcemap,color:X.ncolors>0,...Zr(e),define:G};if(e.watch){const s=e.projectID;(!j.outfile&&!j.outdir||j.write===!1)&&(j.outfile=W.join(Ae.tmpdir(),`esbuild.${s}.out.js`),delete j.write),j.metafile||(j.metafile=W.join(Ae.tmpdir(),`esbuild.${s}.meta.json`))}j.metafile&&c.debug(()=>`writing esbuild meta to ${j.metafile}`),t.rebuild=()=>w([]).then(s=>(S&&c.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),s));function b(s,{warnings:f}){br(f||[]);const d=e.outfile,m=We(le()-s);if(!d)c.info(N.green(e.outdir?`Wrote to dir ${e.outdir} (${m})`:`Finished (write=false, ${m})`));else{let y=d;if(e.sourcemap&&e.sourcemap!="inline"){const I=W.extname(d),D=W.join(W.dirname(d),W.basename(d,I));y=`${D}.{${I.substr(1)},${I.substr(1)}.map}`,Xr(W.resolve(e.cwd,e.outfile+".map"),{sourcesContent:void 0,sourceRoot:W.relative(W.dirname(e.outfile),e.cwd)})}let _=0;try{_=ae.statSync(d).size}catch(I){}e.outfileIsTemporary||c.info(N.green(`Wrote ${y}`)+` (${ht(_)}, ${m})`)}return C({warnings:f,errors:[]},!0)}function x(s,f,d){let m=f.warnings||[],y=f.errors||[],_=d&&d.showStackTrace;return y.length==0&&y.push({text:String(_&&f.stack?f.stack:f),location:null}),br(m),C({warnings:m,errors:y},!1)}async function w(s){if(e.watch&&e.clear&&g(),e.onStart)try{const m=e.onStart(e,s,t);m instanceof Promise&&await m}catch(m){throw c.debug(()=>`error in onStart handler: ${m.stack||m}`),m}if(e.isCancelled)return;c.debug(()=>`invoking esbuild.build() in ${process.cwd()} with options: ${z(j)}`);const f=process.cwd();process.chdir(e.cwd);const d=cr.build(j);return process.chdir(f),d.then(b.bind(null,le()),x.bind(null,le()))}const F=n.diag?null:w([]),[T,E]=u!=="off"?tn(u,n,e):[null,!1];T&&!E&&(T.catch(s=>(c.error(s.stack||String(s)),!1)),t.addCancelCallback(()=>{T.cancel()}),M.diag&&e.watch&&e.clear&&re.clear());let i=!0;if(F&&(c.debug("awaiting esbuild"),i=await F,e.isCancelled))return!1;if(e.watch)return await Ke().watchFiles(e,j.metafile,t,s=>{const f=s.map(m=>W.relative(e.cwd,m)),d=s.length;return c.info(`${d} ${d>1?"files":"file"} changed: ${f.join(", ")}`),w(s)}),c.debug("fswatch ended"),!0;if(T){let s=null;i?(c.debug("awaiting eslint"),!E&&!n.diag&&(s=setTimeout(()=>c.info("Waiting for TypeScript... (^C to skip)"),1e3)),i=await T.catch(()=>!1)):(c.debug("cancelling eslint since esbuild reported an error"),T.cancel()),clearTimeout(s)}if(!e.isCancelled&&!i&&pr(),i){const s=await Qt();process.exitCode=s}return i}const wr=new Map;function tn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return c.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(c.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules={...r.tsrules,...o.rules});const l=t.diag&&r.watch&&r.clear,a=he(r),u=`${a||r.cwd}`,p=wr.get(u);if(p)return c.debug(()=>"tslint sharing process (no new process created)"),[p,!0];const g={colors:N.ncolors>0,quiet:r.quiet,mode:n,...o,watch:r.watch,cwd:r.cwd,clearScreen:l,srcdir:it(r.entryPoints[0]),tsconfigFile:a,onRestart(){c.debug("tsc restarting")}};c.debug(()=>`starting tslint with options ${z(g)}`);const S=Xe(g);return wr.set(u,S),[S,!1]}function br(e){e.length>0&&c.warn("[warn] "+e.map(t=>t.text).join(`
`))}function yr(e){e.length>0&&c.error(e.map(t=>t.text).join(`
`))}function rn(){return hr({[$e]:1}).catch(e=>{console.error(X.red(J+": "+(e?e.stack||e:"error")));const t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{const t=process.exitCode||0;process.exit(e||t>0?t:1)})}function xr(){M["no-color"]&&(M.color=!1),M["no-diag"]&&(M.diag=!1),c.colorMode=M.color,N.reconfigure(process.stdout,M.color),X.reconfigure(process.stderr,M.color),M.color!==void 0,M["estrella-version"]&&(console.log("estrella 1.2.3"),process.exit(0)),M["estrella-debug"]&&(c.level=c.DEBUG),M.diag&&M.run&&(c.info("Disabling -run since -diag is set"),M.run=void 0),c.debug(()=>`Parsed initial CLI arguments: ${z({options:M,args:V},2)}`)}module.id=="."||process.mainModule&&dr(process.mainModule.filename||"")=="estrella.js"?([M,V]=ke(process.argv.slice(2),Jr),xr(),rn()):([M,V]=ke(process.argv.slice(2),{...be,unknownFlagAsArg:!0,help(e,t,r){st=new Promise(n=>{process.nextTick(()=>{console.log(ze(e,be.usage,be.trailer)),process.exit(0),n()})})}}),xr(),V.length>0&&st.then(()=>{V.length>0&&Ue(V)}),M.parse=(...e)=>{c.debug(()=>`Parsing custom CLI arguments ${L(V.join)} via cliopts.parse(`+z(e)+")");const t=ke(V,{...be,flags:be.flags.concat(e)});return c.debug(()=>"Parsed extra CLI arguments: "+L({options:t[0],args:t[1]},2)),V.splice(0,V.length),t});function Sr(e,t,r){return Ke().watch(e,t,r)}function nn(e,t,r,n){return c.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r={...r,filter:t},r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),Sr(e,r,n)}let at;module.exports={version:"1.2.3",prog:J,cliopts:M,cliargs:V,dirname:it,basename:dr,watch:Sr,watchdir:nn,scandir:ir,tslint:Xe,defaultTSRules:Ve,termStyle:Te,stdoutStyle:N,stderrStyle:X,chmod:q.chmod,editFileMode:q.editMode,fmtDuration:We,tildePath:se,findInPATH:ve,tsconfig:ye,tsconfigFile:he,glob:ce.glob,globmatch:ce.match,file:q,sha1:Re,log:c,get ts(){return at===void 0&&(at=er()),at},build:hr};
//# sourceMappingURL=estrella.js.map
