#!/usr/bin/env node
let e$=Object.defineProperty,f$=Object.hasOwnProperty,h$={},j$,k$=a$=>{let b$=h$[a$];return b$||(b$=h$[a$]={exports:{}},j$[a$](b$.exports,b$)),b$.exports},l$=a$=>{if(a$&&a$.__esModule)return a$;let b$={};for(let c$ in a$)f$.call(a$,c$)&&(b$[c$]=a$[c$]);return b$.default=a$,b$},p$=a$=>l$(k$(a$)),q$=(a$,b$)=>{e$(a$,"__esModule",{value:!0});for(let c$ in b$)e$(a$,c$,{get:b$[c$],enumerable:!0})};j$={0(r,N){!function(t,u){"object"==typeof r&&"undefined"!=typeof N?u(r):"function"==typeof define&&define.amd?define(["exports"],u):u(t.miniglob={})}(r,function(t){"use strict";const{readdirSync:u,statSync:x}=require("fs"),o=(()=>{try{returnrequire("path").sep}catch(a){return"/"}})(),k=o.charCodeAt(0),O=":"==o?/\:+/g:"\\"==o?/\\+/g:/\/+/g,v="win32"==process.platform;class q extends Error{constructor(){super("bad pattern")}}const P=v?a=>{if(a.length<2)return 0;let b=a[0];return":"==a[1]&&("a"<=b&&b<="z"||"A"<=b&&b<="Z")?2:0}:a=>0,Q=v?(a,b)=>{const d=b(a);return""==a?[0,"."]:d+1==a.length&&F(a,a.length-1)?[d+1,a]:d==a.length&&2==a.length?[d,a+"."]:(d>=a.length&&(d=a.length-1),[d,a.substr(0,a.length-1)])}:(a,b)=>""==a?[b,"."]:a==o?[b,a]:[b,a.substr(0,a.length-1)];function F(a,b){return a.charCodeAt(b)===k}function R(a,b){a=function(c){let e=c.length-1,f=e;for(;f&&c.charCodeAt(f)===k;)--f;return f!=e&&(c=c.substr(0,f+1)),c.split(O).join(o)}(a);let d=x(a);d.isDirectory()&&function c(e,f,g){for(let n of u(e)){let l=K(e,n),i=A(l),h=f(l,i);(h||void 0===h)&&i&&i.isDirectory()&&!g.has(i.ino)&&(g.add(i.ino),c(l,f,g))}}(a,b,new Set([d.ino]))}function y(a){let b=[];if(!H(a))return A(a)?[a]:b;let d=P(a),c=a.length-1;for(;c>=d&&!F(a,c);)c--;let e=a.substr(0,c+1),f=a.substr(c+1);if([d,e]=Q(e,d),H(e.substr(d))){if(e==a)throw new q();const g=y(e);for(let n of g)G(n,f,b)}else G(e,f,b);return b}function G(a,b,d){const c=A(a);if(null===c)return;if(!c.isDirectory())return;let e;try{e=u(a)}catch(f){return}e.sort();for(let f of e)z(b,f)&&d.push(K(a,f))}function H(a){for(let b=0;b<a.length;++b)switch(a.charCodeAt(b)){case 42:case 63:case 91:case 123:return!0}return!1}function S(a,b){for(let d=0;d<a.length;++d)if(a.charCodeAt(d)===b)return!0;return!1}function z(a,b){r:for(;a.length>0;){let d=!1,c="";if([d,c,a]=T(a),d&&""==c)return!S(b,k);let[e,f]=I(c,b);if(!f||!(0==e.length||a.length>0)){if(d){for(let g=0;g<b.length&&b.charCodeAt(g)!=k;g++)if([e,f]=I(c,b.substr(g+1)),f){if(0==a.length&&e.length>0)continue;b=e;continue r}}return!1}b=e}return 0==b.length}function T(a){let b=!1;for(;a.length>0&&42==a.charCodeAt(0);)a=a.substr(1),b=!0;let d=!1,c=0;r:for(;c<a.length;c++)switch(a.charCodeAt(c)){case 92:v||c+1<a.length&&c++;break;case 91:d=!0;break;case 93:d=!1;break;case 42:if(!d)break r}return[b,a.substr(0,c),a.substr(c)]}function I(a,b){for(;a.length>0;){if(0==b.length)return["",!1];switch(a.charCodeAt(0)){case 91:{let c=b.codePointAt(0),e=c<=65535?1:2;if(b=b.substr(e),a=a.substr(1),c.toString(16),0==a.length)throw new q();let f=94==a.charCodeAt(0);f&&(a=a.substr(1));let g=!1,n=0;for(;;){if(a.length>0&&93==a.charCodeAt(0)&&n>0){a=a.substr(1);break}let l,i;if([i,a,l]=J(a),!l)return["",!1];let h=i;if(45==a.charCodeAt(0)&&([h,a,l]=J(a.substr(1)),!l))return["",!1];i<=c&&c<=h&&(g=!0),n++}if(g==f)return["",!1];break}case 63:if(b.charCodeAt(0)==k)return["",!1];let d=b.codePointAt(0)<=65535?1:2;b=b.substr(d),a=a.substr(1);break;case 92:if(!v&&0==(a=a.substr(1)).length)throw new q();default:if(a.charCodeAt(0)!=b.charCodeAt(0))return a[0],b[0],a.charCodeAt(0).toString(16),b.charCodeAt(0).toString(16),["",!1];b=b.substr(1),a=a.substr(1)}}return[b,!0]}function J(a){let b=0,d="",c=a.charCodeAt(0);if(0==a.length||45==c||93==c)throw new q();if(92==c&&!v&&0==(a=a.substr(1)).length)throw new q();let e=(b=a.codePointAt(0))<=65535?1:2;if(65535==b&&1==e)throw new q();if(0==(d=a.substr(e)).length)throw new q();return[b,d,!0]}function A(a){try{return x(a)}catch(b){}return null}function K(a,b){return"."==a||""==a?b:a+o+b}t.PatternError=q,t.glob=function(a){if(a.indexOf("**")<0)return y(a);let b=[],d=new Set();return function c(e,f,g,n,l){g>=f.length&&(g=f.length-1);let i=f[g],h=i;function B(j){return!l.has(j)&&(l.add(j),!0)}function L(j){let p=j,m=p.lastIndexOf(o);-1!=m&&(p=p.substr(m+1));let C=Math.min(g+1,f.length-1),s=f.slice(C).join("*");s.charCodeAt(0)==k?s=function(D){let w=0;for(;D.charCodeAt(w)===k;)w++;return 0!=w?D.substr(w):D}(s):"*"!=s[0]&&(s="*"+s),z(s,p)&&n.push(j)}0===g?i.charCodeAt(i.length-1)!=k&&(h+="*"):g===f.length-1?i.charCodeAt(0)!=k&&(h="*"+h):(i.charCodeAt(0)!=k&&(h="*"+h),i.charCodeAt(i.length-1)!=k&&(h+="*")),e&&(h=h[0]!=o?e+o+h:e+h);let M=!1;h.charCodeAt(h.length-1)===k&&(M=!0,h=function(j){let p=j.length-1,m=p;for(;j.charCodeAt(m)===k;)m--;return m!=p?j.substr(0,m+1):j}(h));let U=y(h);for(let j of U){let p=x(j);p.isDirectory()?B(j)&&R(j,(m,C)=>{B(m)&&(C.isDirectory()?c(m,f,g+1,n,l):L(m))}):!M&&B(j)&&L(j)}return n}("",a.split(/\*{2,}/),0,b,d),b},t.match=z,Object.defineProperty(t,"__esModule",{value:!0})})},8(j){q$(j,{clock:()=>m,findInPATH:()=>o,fmtDuration:()=>n,json:()=>l,jsonparse:()=>h,jsonparseFile:()=>p,tildePath:()=>q});const y=l$(require("fs")),z=l$(require("path")),A=l$(require("perf_hooks"));const l=JSON.stringify,m=()=>A.performance.now();function n(a){return a>=59500?(a/60000).toFixed(0)+"min":a>=999.5?(a/1000).toFixed(1)+"s":a.toFixed(2)+"ms"}function o(a){const b=process.platform.startsWith("win")&&!/\.exe$/i.test(a);for(let f of(process.env.PATH||"").split(z.delimiter)){let d=z.join(z.resolve(f),a);for(;;){try{let e=y.statSync(d);if(e.isSymbolicLink()){d=y.realpathSync.native(d);continue}else if(e.isFile()&&e.mode&y.constants.X_OK)return d}catch(e){}break}}return null}function h(a,b){const f=require("vm");return f.runInNewContext("(()=>("+a+"))()",{},{filename:b,displayErrors:!0})}function p(a){return h(y.readFileSync(a,"utf8"),a)}let c=null;function q(a){const b=z.resolve(a);return c||(c=require("os").homedir()),b.startsWith(c)?"~"+b.substr(c.length):b}},3(g){q$(g,{isMemoized:()=>d,memoize:()=>i});const m=p$(8);const b=new Map();const d=Symbol("isMemoized");function i(j){return function n(...e){let c=e.map(m.json).join("\0");if(!b.has(c)){const f=j(...e);return b.set(c,f),f}let a=b.get(c);return a&&typeof a=="object"&&(a[d]=!0),a}}},5(l){q$(l,{stderrStyle:()=>n,style:()=>m,termStyle:()=>e});function e(j,k){let c=0;if(k==!0){let b=process.env.TERM||"";c=b&&["xterm","screen","vt100"].some(d=>b.indexOf(d)!=-1)?b.indexOf("256color")!=-1?8:4:2}else k!==!1&&j.isTTY&&(c=j.getColorDepth());const a=c>=8?(b,d,f)=>{let g="["+d+"m",h="["+f+"m";return i=>g+i+h}:c>0?(b,d,f)=>{let g="["+b+"m",h="["+f+"m";return i=>g+i+h}:()=>b=>b;return{ncolors:c,reset:"e[0m",bold:a("1","1","22"),italic:a("3","3","23"),underline:a("4","4","24"),inverse:a("7","7","27"),white:a("37","38;2;255;255;255","39"),grey:a("90","38;5;244","39"),black:a("30","38;5;16","39"),blue:a("34","38;5;75","39"),cyan:a("36","38;5;87","39"),green:a("32","38;5;84","39"),magenta:a("35","38;5;213","39"),purple:a("35","38;5;141","39"),pink:a("35","38;5;211","39"),red:a("31","38;2;255;110;80","39"),yellow:a("33","38;5;227","39"),lightyellow:a("93","38;5;229","39"),orange:a("33","38;5;215","39")}}let m=e(process.stdout),n=e(process.stderr)},1(s){q$(s,{chmod:()=>u,editFileMode:()=>p});const z=l$(require("fs")),A=p$(8);const d=z.constants,B=d.S_IRUSR,C=d.S_IWUSR,D=d.S_IXUSR,E=d.S_IRGRP,F=d.S_IWGRP,G=d.S_IXGRP,H=d.S_IROTH,I=d.S_IWOTH,J=d.S_IXOTH,o=String.fromCharCode,t=(a,b)=>a.charCodeAt(b||0);function u(a,b){if(typeof b=="number")return z.chmodSync(a,b),b;let h=z.statSync(a).mode,e=p(h,b);return h!=e&&z.chmodSync(a,e),e}function p(a,b){const h="Expected format: [ugoa]*[+-=][rwx]+",e=(c,g)=>new Error(`${c} in modifier ${A.json(g)}. ${h}`);let m=[];for(let c of Array.isArray(b)?b:[b])m=m.concat(c.trim().split(/\s*,+\s*/));for(let c of m){let g=[],r=!1,k=0,f=0;for(let l=0;l<c.length;l++){let j=t(c,l);if(k==0)switch(j){case 117:case 103:case 111:r||g.push(j);break;case 97:g=[117,103,111],r=!0;break;case 43:case 45:case 61:k=j;break;default:if(k==0)throw e(`Invalid target or operation ${A.json(o(j))}`,c);break}else switch(j){case 114:f|=4;break;case 119:f|=2;break;case 120:f|=1;break;default:throw e(`Invalid permission ${A.json(o(j))}`,c)}}if(k==0)throw e("Missing operation",c);g.length==0&&(g=[117]),f==0&&(f=4|2|1);let i=0;for(let l of g)switch(l){case 117:i|=f<<6;break;case 103:i|=f<<3;break;case 111:i|=f;break}switch(k){case 43:a|=i;break;case 45:a&=~i;break;case 61:a=i;break}}return a}},4(e){q$(e,{screen:()=>b});const c=!!process.stdout.isTTY,f=!!process.stderr.isTTY;const b={width:60,height:20,clear(){},banner(a){return a||(a="-"),a.repeat(Math.floor((b.width-1)/a.length))}};if(c||f){const a=c&&process.stdout||process.stderr,d=()=>{b.width=a.columns,b.height=a.rows};a.on("resize",d),d(),b.clear=()=>{a.write("c")}}},9(q){q$(q,{scandir:()=>s,watchdir:()=>r});const y=l$(require("fs")),z=l$(require("path"));function r(h,c,a,d){d===void 0&&(a===void 0?(d=c,c=null):(d=a,a=null)),a||(a={});const p=a.latency===void 0?100:a.latency,l=!!a.recursive,e=new Set();let b=null;function j(){b=null;const g=d(Array.from(e));e.clear();if(g instanceof Promise){const k=()=>{b=null,e.size>0&&j()};g.then(k).catch(k),b=1}}const o=(g,k)=>{if(c&&!c.test(k))return;e.add(k),b===null&&(b=setTimeout(j,p))};let i=(Array.isArray(h)?h:[h]).map(g=>y.watch(g,{recursive:l},o)),f=!1;const v=()=>{clearTimeout(b),f||(f=!0,i.map(g=>g.close()))};return v}async function s(h,c,a){a||(a={});if(!y.promises||!y.promises.opendir)throw new Error("not implemented for nodejs <12.12.0");const d=[],p=h,l=new Set();async function e(b,j){if(l.has(b))return;l.add(b);const o=await y.promises.opendir(b);for await(const i of o){let f=i.name;i.isDirectory()?a.recursive&&await e(z.join(b,f),z.join(j,f)):(i.isFile()||i.isSymbolicLink())&&(c&&c.test(f)&&d.push(z.join(j,f)))}}return e(z.resolve(h),".").then(()=>d.sort())}},7(m){q$(m,{findTSC:()=>r,findTSConfigFile:()=>h,getTSConfigFileForConfig:()=>i,getTSConfigForConfig:()=>s});const o=l$(require("path")),w=l$(require("fs")),x=p$(8);const{dirname:q,basename:y}=o;function r(a){let b="",c=process.cwd();a&&process.chdir(a);try{b=null.resolve("typescript")}catch(d){}finally{a&&process.chdir(c)}if(b){const d=o.sep+"node_modules"+o.sep;let l=b.indexOf(d);if(l!=-1)return o.join(b.substr(0,l+d.length-o.sep.length),".bin","tsc")}return"tsc"}function h(a){a=o.resolve(a);const b=o.parse(a).root;for(;;){let c=o.join(a,"tsconfig.json");if(w.existsSync(c))return c;a=q(a);if(a==b)break}return null}const e=Symbol("TS_CONFIG_FILE"),f=Symbol("TS_CONFIG");function i(a){let b=a[e];if(b===void 0)if(a.tsc==="off"||a.tsc===!1)a[e]=b=null;else{let c=a.cwd||process.cwd();a.entryPoints&&a.entryPoints.length>0&&(c=o.resolve(c,a.entryPoints[0])),a[e]=b=h(c)}return b}function s(a){let b=a[f];if(b!==void 0)return b;const c=i(a);if(c)try{return a[f]=x.jsonparseFile(c)}catch(d){}return a[f]=null}},6(M){q$(M,{defaultTSRules:()=>B,tslint:()=>V});const O=l$(require("path")),ia=l$(require("fs")),ja=p$(8),la=p$(5),ma=p$(4),na=p$(7);const{dirname:T,basename:oa}=O;const B={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"};const C=0,D=1,E=2,U=3,F={IGNORE:C,INFO:D,WARNING:E,ERROR:U};function G(b,i){for(let h of Object.keys(i)){let f=F[String(i[h]).toUpperCase()];if(f===void 0)throw new Error(`Invalid value for TS rule ${h}: ${ja.json(f)} -- expected value to be one of: `+Object.keys(F).map(ja.json).join(", "));b[h]=f}}function V(b){b||(b={});let i={cancelled:!1,cancel(){}},h=new Promise((f,H)=>{if(b.mode=="off")return f(!0);const v=b.quiet?()=>{}:console.log.bind(console),k=b.cwd||process.cwd(),l=b.mode=="on"?null:b.tsconfigFile?b.tsconfigFile:na.findTSConfigFile(b.srcdir?O.resolve(k,b.srcdir):k);if(b.mode!="on"&&!l)return f(!0);let j=na.findTSC(b.cwd);if(j=="tsc"&&b.mode!="on"){if(!(j=ja.findInPATH(j)))return console.warn(la.stderrStyle.orange(prog+":")+" tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+O.relative(process.cwd(),T(l))+"."` Set tslint options.tsc="off" or pass -no-diag on the command line.`),f(!0)}const m={};G(m,B),b.rules&&G(m,b.rules);let q=["--noEmit",b.colors&&"--pretty",b.watch&&"--watch"].concat(b.args||[]).filter(a=>a);const{spawn:_}=require("child_process"),r=_(j,q,{stdio:["inherit","pipe","inherit"],cwd:k}),I=()=>{try{r.kill()}catch(a){}};process.on("exit",I),i.cancel=()=>{r.kill()};const J=a=>a,w=la.style.orange,$=la.style.red,aa=la.style.green,ba=Buffer.from(" TS"),ca=Buffer.from("Found "),da=Buffer.from("c"),ea=Buffer.from("Starting compilation"),o=[];let p=0,K=!1,e={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},x=!1;function s(){if(!b.quiet||e.errors>=0){b.watch&&console.log(ma.screen.banner("â€”"));let a=[];e.errors>0?a.push($("TS: "+y("$ error","$ errors",e.errors))):a.push(aa("TS: OK")),e.warnings>0&&a.push(w(y("$ warning","$ warnings",e.warnings))),e.other>0&&a.push(y("$ message","$ messages",e.other)),console.log(a.join("   ")),b.watch&&console.log(ma.screen.banner("â€”"))}K=e.errors>0,b.onEnd&&b.onEnd(e),e.reset(),x=!0}function t(a){const d=o.slice();o.length=0;if(p==0){const c=d[0];if(c.includes(ea))return e.reset(),a&&s();if(d.every(g=>g.length<=1))return a&&s()}else{const c=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g;let g=d.shift().toString("utf8");switch(m[p]){case C:return a&&s();case D:g=g.replace(c,J("info")),L(d,J),e.other++;break;case E:g=g.replace(c,w("warning")),L(d,w),e.warnings++;break;default:c.test(g)?e.errors++:e.other++;break}process.stdout.write(g)}d.forEach(c=>process.stdout.write(c)),a&&s()}function L(a,d){for(let c=1;c<a.length;c++){let g=a[c];if(g.includes(126)){let n=g.toString("utf8");n=n.replace(/\x1b\[\d+m(\s*~+)/g,d("$1")),a[c]=n}}}function y(a,d,c){return(c==1?a:d).replace(/\$/g,c)}X(r.stdout,(a,d)=>{b.clearScreen||(a=ga(a));if(d){a.length>0&&o.push(a),o.length>0&&t();return}x&&a.length>1&&(x=!1,b.onRestart&&b.onRestart());if(a.includes(ca)){let c=fa(a.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(c)){t(!0),p=0;return}else t(!1);p=0}else if(a.includes(ba)){const c=a.toString("utf8"),g=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(c);let n=g?parseInt(g[1]):0;n>0&&!isNaN(n)&&(o.length>0&&t(),p=n)}o.push(a)}),r.on("close",a=>{process.removeListener("exit",I),f(!K)});function fa(a){return a.replace(/\x1b\[\d+m/g,"")}function ga(a){let d=a.indexOf(da);return d==-1?a:d==0?a.subarray(3):Buffer.concat([a.subarray(0,d),a.subarray(d+3)],a.length-3)}});return h.cancel=()=>(i.cancelled||(i.cancelled=!0,i.cancel()),h),h}const W=Buffer.allocUnsafe(0);function X(b,i){let h=[],f=0;const H=k=>{let l=0;for(;;){let j=k.indexOf(10,l);if(j==-1){if(l<k.length-1){const q=k.subarray(l);h.push(q),f+=q.length}break}j++;let m=k.subarray(l,j);f>0&&(m=Buffer.concat(h.concat(m),f+m.length),h.length=0,f=0),i(m,!1),l=j}},v=()=>{h.length>0?i(Buffer.concat(h,f),!0):i(W,!0)};b.on("data",H),b.on("close",v),b.on("end",v)}},2(Na,P){const Pa=l$(require("esbuild")),Qa=l$(require("fs")),na=l$(require("path")),Ra=p$(0),Sa=p$(8),Ta=p$(3),Ua=p$(5),Va=p$(1),Wa=p$(4),Xa=p$(9),Ya=p$(6),Za=p$(7);const{dirname:D,basename:X}=na,ta=`
usage: $0 [options]
options:
  -watch, -w          Watch source files for changes and rebuild.
  -debug, -g          Do not optimize and define DEBUG=true.
  -sourcemap          Generate sourcemap.
  -inline-sourcemap   Generate inline sourcemap.
  -color              Color terminal output, regardless of TTY status.
  -no-color           Disable use of colors.
  -no-clear           Disable clearing of the screen, regardless of TTY status.
  -no-diag            Disable TypeScript diagnostics.
  -diag               Only run TypeScript diagnostics (no esbuild.)
  -quiet              Only log warnings and errors but nothing else.
  -h, -help           Print help to stderr and exit 0.
  -estrella-version   Print version of estrella and exit 0.
  -estrella-debug     Enable debug logging of estrella itself.
`,Y={w:!1,watch:!1,debug:!1,g:!1,color:!1,"no-color":!1,sourcemap:!1,"inline-sourcemap":!1,"no-clear":!1,"no-diag":!1,diag:!1,quiet:!1,"estrella-debug":!1,"estrella-version":!1},Z={helpUsage:"usage: $0 [options] <srcfile> ...",helpExtraText:`
  -bundle             Bundle all dependencies into the output files.
  -minify             Simplify and compress generated code.
  -o, -outfile <file> Write output to <file> instead of stdout.
  -outdir <dir>       Write output to <dir> instead of stdout.
  `,extraOptions:{bundle:!1,minify:!1,outdir:"",outfile:"",o:""}},ua=new Set(["cwd","debug","entry","onEnd","onStart","outfileMode","quiet","title","tsc","tsrules","watch"]),t=(process.env._||"/node").endsWith("/node")?process.argv[1]:process.env._;var o=()=>{};function _(...b){const a={};Error.captureStackTrace(a,_);const e=(a.stack?a.stack.split(`
`,3):[])[1],c=e&&/at (\w+)/.exec(e),m=c?" "+c[1]:"";b=b.map(j=>typeof j=="function"?j():j),console.error(Ua.stderrStyle.pink(`[DEBUG${m}]`),...b)}let $=!1;function L(b){if(!$){$=!0;let a=b||1;process.on("exit",e=>{process.exit(e||a)})}}function va(b){o(()=>`processing ${Sa.json(b)}`),b.entryPoints||(b.entryPoints=[]),b.entry&&(Array.isArray(b.entry)?b.entryPoints=b.entryPoints.concat(b.entry):b.entryPoints.push(b.entry)),delete b.entry;if(b.entryPoints.length==0){o(()=>"missing entryPoints; attempting inference"),b.entryPoints=aa(b);if(b.entryPoints.length==0){let a=Za.getTSConfigForConfig(b)?" (could not guess from tsconfig.json)":"";throw new Error(`config.entryPoints is empty or not set${a}`)}}b.sourcemap?b.sourcemap!="inline"&&(b.sourcemap="external"):delete b.sourcemap,o(()=>`final ${Sa.json(b)}`)}function aa(b){const a=Za.getTSConfigForConfig(b);o(()=>`getTSConfigForConfig => ${Sa.json(a)}`);if(a){if(a.files)return a.files;if(a.include){let e=[];for(let c of a.include)o(`glob.glob(${c}) =>`,Ra.glob(c)),e=e.concat(Ra.glob(c));if(a.exclude)for(let c of a.exclude)e=e.filter(m=>!Ra.match(c,m));return e.slice(0,1)}}return[]}function wa(b){let a={};for(let e of Object.keys(b))ua.has(e)||(a[e]=b[e]);return a}function E(b,a){b&&console.error(`${t}: ${b}`);let e=ta.trim();a&&(a.helpUsage&&(e=a.helpUsage+e.substr(e.indexOf(`
`))),a.helpExtraText&&(e+=a.helpExtraText)),e=e.replace(/\$0\b/g,t),console.error(e.trim()),process.exit(b?1:0)}function ba(b,a,e){e&&(b={...b,...e.extraOptions});const c={...b},m=new Set();let j=[],n=1;function u(g,k,y){let h=b[g];const v=typeof h;if(typeof h=="boolean")c[g]=!h;else{const w=k?k:a[++n];w===void 0&&E(`missing value for option ${y}`,e),Array.isArray(h)?(c[g]||(c[g]=[])).push(w):c[g]=w}}for(;n<a.length;n++){let g=a[n];if(g=="--"){j=j.concat(a.slice(n+1));break}if(g.startsWith("-")&&g!="-"){const[k,y]=g.replace(/^\-+/,"").split("=");(k=="h"||k=="help")&&E(null,e);if(!(k in b)){if(g[1]!="-"&&!y){let h=k.split("");if(h.every(v=>typeof b[v]=="boolean")){h.map(v=>u(v,"",g));continue}}E(`unknown option ${g}`,e)}u(k,y,g)}else j.push(g)}return c["estrella-version"]&&(console.log(`estrella ${"1.0.6"}${""}`),process.exit(0)),o=c["estrella-debug"]?_:()=>{},{opts:c,args:j}}const ca=Symbol("IS_MAIN_CALL");async function da(b,a){let e=!1;a===ca&&(a={},e=!0);const{opts:c,args:m}=ba(Y,b,e?Z:null);e||(a&&(a={...a}),va(a));if(e){if(m.length==0){m.splice(m.length-1,0,...aa(a));const d=Za.getTSConfigForConfig(a);!c.outfile&&!c.outdir&&d&&(c.outfile=d.outFile,c.outfile||(c.outdir=d.outDir)),m.length==0&&E("missing <srcfile> argument",Z)}a.entryPoints=m,a.outfile=c.o||c.outfile||void 0,a.outdir=c.outdir||void 0,a.bundle=c.bundle||void 0,a.minify=c.minify||void 0,a.cwd=process.cwd()}const j=a.watch=c.watch=!!(c.w||c.watch||a.watch),n=a.debug=c.debug=!!(c.debug||c.g||a.debug),u=a.quiet=c.quiet=!!(c.quiet||a.quiet);a.color!==void 0&&(a.color?c.color=!0:c["no-color"]=!0);const g=c.color||(c["no-color"]?!1:void 0);Ua.style=Ua.termStyle(process.stdout,g),Ua.stderrStyle=Ua.termStyle(process.stderr,g);const k=(...d)=>console.error(Ua.stderrStyle.red(`${t}:`),...d),y=console.log.bind(console),h=u?()=>{}:console.log.bind(console),v=u?()=>{}:Ta.memoize(h),w=!!c.diag;let F=c["no-diag"]?"off":w?"on":"auto";a.tsc!==void 0&&a.tsc!=="auto"&&(F=a.tsc&&a.tsc!="off"?"on":"off");if(w&&F=="off")return k("invalid configuration: diagnostics are disabled but only disagnostics was requested."),L(1),!1;const ia=c["inline-sourcemap"]?"inline":c.sourcemap?"external":a.sourcemap;process.stdout.isTTY||(c["no-clear"]=!0);const q=a.cwd?na.resolve(a.cwd):process.mainModule&&D(process.mainModule.filename)||__dirname;if(q!=process.cwd()){let d=na.relative(process.cwd(),q);d.startsWith(".."+na.sep)&&(d=q),v(`Changing working directory to ${d}`)}a.cwd=q,a.title||(a.title=a.name||Sa.tildePath(a.cwd));let ja=0;function Fa(){Wa.screen.clear(),ja=Sa.clock()}let Ga=a.onStart||(()=>{}),G=a.onEnd?(d,f)=>{const l=a.onEnd(a,d),i=A=>A===void 0?f:A;return l instanceof Promise?l.then(i):i()}:(d,f)=>f;if(a.outfileMode){let d=G;G=(f,l)=>{try{Va.chmod(a.outfile,a.outfileMode)}catch(i){k("configuration error: outfileMode: "+i.message),L(1)}return d(f,l)}}function Ha(d,{stderr:f,warnings:l}){ea(l);const i=a.outfile;if(!i)f=f.replace(/\n$/,""),f.length>0&&h(f);else{const A=/\(([^\)]+)\)\n/.exec(f),La=Sa.fmtDuration(Sa.clock()-d);let ma=i;if(ia=="external"){const O=na.extname(i),Ma=na.join(na.dirname(i),na.basename(i,O));ma=`${Ma}.{${O.substr(1)},${O.substr(1)}.map}`}h(Ua.style.green(`Wrote ${ma}`)+` (${A?A[1]:"?B"}, ${La})`)}return G({warnings:l,errors:[]},!0)}function Ia(d,{stderr:f,warnings:l,errors:i}){return ea(l),console.error(f),i.length==0&&i.push({text:f.trim(),location:null}),/^error: must provide/i.test(f)&&(a||process.exit(1)),G({warnings:l,errors:i},!1)}let H={DEBUG:n,...a.define||{}};for(let d in H)H[d]=Sa.json(H[d]);const Ja={minify:!n,sourcemap:ia,color:Ua.stderrStyle.ncolors>0,...wa(a),define:H};async function ka(){j&&!c["no-clear"]&&Fa();const d=Ga(a);d instanceof Promise&&await d;const f=process.cwd();process.chdir(q);const l=Pa.build(Ja);return process.chdir(f),l.then(Ha.bind(null,Sa.clock()),Ia.bind(null,Sa.clock()))}const Ka=c.diag?Promise.resolve():ka();let r=null,N=!1;if(F!="off"){const d=j&&c.diag&&!c["no-clear"];r=Ta.memoize(Ya.tslint)({watch:j,quiet:u,clearScreen:d,colors:Ua.style.ncolors>0,cwd:q,mode:F,srcdir:D(a.entryPoints[0]),rules:a.tsrules,tsconfigFile:Za.getTSConfigFileForConfig(a),onRestart(){!c["no-clear"]&&Sa.clock()-ja>5000&&Wa.screen.clear()}}),N=Ta.isMemoized in r;if(c.diag)return d&&Wa.screen.clear(),r;N||r.catch(f=>(k(f.stack||String(f)),!1))}let z=await Ka;if(!j){if(r){let d;z?(N||(d=setTimeout(()=>h("Waiting for TypeScript... (^C to skip)"),1000)),z=await r.catch(()=>!1)):r.cancel(),clearTimeout(d)}if(a)return z||L(),z;process.exit(z?0:1)}h("Watching files for changes...");const la=Array.from(new Set(a.entryPoints.map(d=>D(na.resolve(na.join(q,d))))));o(()=>["watching dirs:",la]),Xa.watchdir(la,/\.[tj]s$/,{recursive:!0},d=>{h(d.length+" files changed:",d.join(", ")),ka()})}function ea(b){b.length>0&&console.log("[warn] "+b.map(a=>a.text).join(`
`))}function xa(){return da(process.argv.slice(1),ca).catch(b=>{console.error(Ua.stderrStyle.red(t+": "+(b.stack||b))),process.exit(1)}).then(()=>{process.exit(0)})}if(P.id=="."||process.mainModule&&X(process.mainModule.filename||"")=="estrella.js"){xa();return}const{opts:p,args:ya}=ba(Y,process.argv.slice(1));p.watch=!!(p.watch||p.w),p.debug=!!(p.debug||p.g),P.exports={prog:t,cliopts:p,cliargs:ya,dirname:D,basename:X,watchdir:Xa.watchdir,scandir:Xa.scandir,tslint:Ya.tslint,defaultTSRules:Ya.defaultTSRules,termStyle:Ua.termStyle,chmod:Va.chmod,editFileMode:Va.editFileMode,fmtDuration:Sa.fmtDuration,tildePath:Sa.tildePath,findInPATH:Sa.findInPATH,tsconfig:Za.getTSConfigForConfig,tsconfigFile:Za.getTSConfigFileForConfig,glob:Ra.glob,globmatch:Ra.match,build(b){return da(process.argv.slice(1),b).catch(a=>{console.error(Ua.stderrStyle.red(t+": "+(a.stack||a))),process.exit(1)})}}}};module.exports=k$(2);
